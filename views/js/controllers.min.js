define("taoDevTools/controller/routes",[],function(){return{ExtensionsManager:{actions:{index:"controller/settings/extensionManager"}},ScriptRunner:{actions:{index:"controller/ScriptRunner/index"}}}}),define("taoDevTools/controller/ControllerMap/index",function(){}),define("taoDevTools/controller/ScriptRunner/index",["jquery","helpers"],function($,helpers){return{start:function(){$(".script").click(function(event){var action=$(event.target).data("action");$.ajax({type:"POST",url:helpers._url(action,"ScriptRunner","taoDevTools"),dataType:"json",success:function(data){helpers.loaded(),data.success?helpers.createInfoMessage(data.message):helpers.createErrorMessage(data.message)
}})})}}}),define("taoDevTools/controller/settings/extensionManager",["jquery","i18n","context","helpers"],function($,__,context,helpers){function getDependencies(extension){var dependencies=[];return $("#"+extension+" .dependencies li:not(.installed)").each(function(){var ext=$(this).attr("rel"),deps=getDependencies(ext);deps.push(ext),dependencies=dependencies.concat(deps)}),dependencies}function getUnique(orig){for(var a=[],i=0;i<orig.length;i++)$.inArray(orig[i],a)<0&&a.push(orig[i]);return a}function progressConsole(msg){$("#installProgress .console").append("<p>"+msg+"</p>"),$("#installProgress .console").prop({scrollTop:$("#installProgress .console").prop("scrollHeight")})
}function installNextExtension(){var ext=toInstall[indexCurrentToInstall];$("#installProgress p.status").text(__("Installing extension %s...").replace("%s",ext)),progressConsole(__("Installing extension %s...").replace("%s",ext)),$.ajax({type:"POST",url:context.root_url+"tao/ExtensionsManager/install",data:"id="+ext,dataType:"json",success:function(data){helpers.loaded(),data.success?(progressConsole(__("> Extension %s succesfully installed.").replace("%s",ext)),$("#installProgress .bar").animate({width:"+="+percentByExt+"%"},1e3,function(){indexCurrentToInstall++,hasNextExtensionToInstall()})):(installError=1,progressConsole("Installation of "+ext+" failed")),helpers.createInfoMessage(data.message)
}}),installError&&progressConsole(__("A fatal error occured during the installation process."))}function hasNextExtensionToInstall(){indexCurrentToInstall>=toInstall.length?(toInstall=[],$("#installProgress .bar").animate({backgroundColor:"#bb6",width:"100%"},1e3),progressConsole(__("Generating cache...")),$.ajax({type:"GET",url:$($("#main-menu a")[0]).prop("href"),success:function(){helpers.loaded(),$("#installProgress .bar").animate({backgroundColor:"#6b6"},1e3),$("#installProgress p.status").text(__("Installation done.")),progressConsole(__("> Installation done.")),window.location.reload()}})):installNextExtension()}function styleTables(){$("#Extensions_manager table tr").removeClass("extensionOdd").removeClass("extensionEven"),$("#Extensions_manager table tr:nth-child(even)").addClass("extensionEven"),$("#Extensions_manager table tr:nth-child(odd)").addClass("extensionOdd")
}var ext_installed=[],toInstall=[],indexCurrentToInstall=-1,percentByExt=0,installError=0;return{start:function(){styleTables(),$("#installProgress").hide(),$("#addButton").click(function(){var uri=helpers._url("create","ExtensionsManager","taoDevTools")+"?"+$.param({uri:$("#openuri").val()});return helpers.openTab(__("Create new extension"),uri),!1}),$("#extensions-manager-container .ext-id").each(function(){var ext=$(this).text();ext_installed.push(ext),$(".ext-id.ext-"+ext).addClass("installed")}),$("#available-extensions-container tr input").click(function(event){event.stopPropagation()}),$("#available-extensions-container tr input:checkbox").click(function(){var $installButton=$("#installButton");
$(this).parent().parent().parent().find("input:checkbox:checked").length>0?$installButton.attr("disabled",!1):$installButton.attr("disabled",!0)}),$("#installButton").click(function(event){return toInstall=[],$("#available-extensions-container input:checked").each(function(){var ext=$(this).prop("name").split("_")[1],deps=getDependencies(ext);deps.length&&(toInstall=toInstall.concat(deps)),toInstall.push(ext)}),toInstall=getUnique(toInstall),0==toInstall.length?(alert(__("Nothing to install !")),!1):(percentByExt=100/toInstall.length,$("#installProgress p.status").text(__("%s extension(s) to install.").replace("%s",toInstall.length)),$("#installProgress .bar").width(0),$("#installProgress .console").empty(),progressConsole(__("Do you wish to install the following extension(s):\n%s?").replace("%s",toInstall.join(", "))),$("#installProgress").dialog({modal:!0,width:400,height:300,buttons:[{text:__("No"),click:function(){$(this).dialog("close")
}},{text:__("Yes"),click:function(){progressConsole(__("Preparing installation...")),$(".ui-dialog-buttonpane").remove(),installError=0,indexCurrentToInstall=0,installNextExtension()}}]}),void event.preventDefault())}),$(".disableButton").click(function(event){var id=$(event.target).data("extid");$.ajax({type:"POST",url:context.root_url+"taoDevTools/ExtensionsManager/disable",data:"id="+id,dataType:"json",success:function(data){helpers.loaded(),helpers.createInfoMessage(data.message),data.success&&window.location.reload()}})}),$(".enableButton").click(function(event){var id=$(event.target).data("extid");$.ajax({type:"POST",url:context.root_url+"taoDevTools/ExtensionsManager/enable",data:"id="+id,dataType:"json",success:function(data){helpers.loaded(),helpers.createInfoMessage(data.message),data.success&&window.location.reload()
}})}),$(".uninstallButton").click(function(event){var id=$(event.target).data("extid");$.ajax({type:"POST",url:context.root_url+"taoDevTools/ExtensionsManager/uninstall",data:"id="+id,dataType:"json",success:function(data){helpers.loaded(),helpers.createInfoMessage(data.message),data.success&&window.location.reload()}})})}}});
//# sourceMappingURL=routes.js.map