define("taoDevTools/controller/routes",[],function(){return{ExtensionsManager:{actions:{index:"controller/settings/extensionManager"}}}}),define("taoDevTools/controller/settings/extensionManager",["jquery","i18n","context","helpers"],function(n,e,t,s){function a(e){var t=[];return n("#"+e+" .dependencies li:not(.installed)").each(function(){var e=n(this).attr("rel"),s=a(e);s.push(e),t=t.concat(s)}),t}function o(e){for(var t=[],s=0;s<e.length;s++)n.inArray(e[s],t)<0&&t.push(e[s]);return t}function i(e){n("#installProgress .console").append("<p>"+e+"</p>"),n("#installProgress .console").prop({scrollTop:n("#installProgress .console").prop("scrollHeight")})}function l(){var a=d[g];n("#installProgress p.status").text(e("Installing extension %s...").replace("%s",a)),i(e("Installing extension %s...").replace("%s",a)),n.ajax({type:"POST",url:t.root_url+"tao/ExtensionsManager/install",data:"id="+a,dataType:"json",success:function(t){s.loaded(),t.success?(i(e("> Extension %s succesfully installed.").replace("%s",a)),n("#installProgress .bar").animate({width:"+="+p+"%"},1e3,function(){g++,r()})):(h=1,i("Installation of "+a+" failed")),s.createInfoMessage(t.message)}}),h&&i(e("A fatal error occured during the installation process."))}function r(){g>=d.length?(d=[],n("#installProgress .bar").animate({backgroundColor:"#bb6",width:"100%"},1e3),i(e("Generating cache...")),n.ajax({type:"GET",url:n(n("#main-menu a")[0]).prop("href"),success:function(){s.loaded(),n("#installProgress .bar").animate({backgroundColor:"#6b6"},1e3),n("#installProgress p.status").text(e("Installation done.")),i(e("> Installation done.")),window.location.reload()}})):l()}function c(){n("#Extensions_manager table tr").removeClass("extensionOdd").removeClass("extensionEven"),n("#Extensions_manager table tr:nth-child(even)").addClass("extensionEven"),n("#Extensions_manager table tr:nth-child(odd)").addClass("extensionOdd")}var u=[],d=[],g=-1,p=0,h=0;return{start:function(){c(),n("#installProgress").hide(),n("#addButton").click(function(){var t=s._url("create","ExtensionsManager","taoDevTools")+"?"+n.param({uri:n("#openuri").val()});return s.openTab(e("Create new extension"),t),!1}),n("#extensions-manager-container .ext-id").each(function(){var e=n(this).text();u.push(e),n(".ext-id.ext-"+e).addClass("installed")}),n("#available-extensions-container tr input").click(function(n){n.stopPropagation()}),n("#available-extensions-container tr input:checkbox").click(function(){var e=n("#installButton");n(this).parent().parent().parent().find("input:checkbox:checked").length>0?e.attr("disabled",!1):e.attr("disabled",!0)}),n("#installButton").click(function(t){return d=[],n("#available-extensions-container input:checked").each(function(){var e=n(this).prop("name").split("_")[1],t=a(e);t.length&&(d=d.concat(t)),d.push(e)}),d=o(d),0==d.length?(alert(e("Nothing to install !")),!1):(p=100/d.length,n("#installProgress p.status").text(e("%s extension(s) to install.").replace("%s",d.length)),n("#installProgress .bar").width(0),n("#installProgress .console").empty(),i(e("Do you wish to install the following extension(s):\n%s?").replace("%s",d.join(", "))),n("#installProgress").dialog({modal:!0,width:400,height:300,buttons:[{text:e("No"),click:function(){n(this).dialog("close")}},{text:e("Yes"),click:function(){i(e("Preparing installation...")),n(".ui-dialog-buttonpane").remove(),h=0,g=0,l()}}]}),void t.preventDefault())})}}});