<!doctype html>
<html>
    <head>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap-theme.min.css">

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

        <script src="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.js" type="text/javascript"></script>
        <link href="http://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.css" type="text/css">

        <style>
                     .prettyprint ol.linenums > li { list-style-type: decimal; }
        </style>

    </head>
    <body onload="prettyPrint()">
    <div class="container">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">
                    <a type="button" class="btn btn-info" href="index.html">Back</a>
                    Statistics : <a href="http://www.tao.dev/taoTestTaker/TestTaker/editSubject" target="_blank">http://www.tao.dev/taoTestTaker/TestTaker/editSubject</a>
                </h3>
            </div>
            <div class="panel-body">
                <div class="panel panel-default">
                                            <div class="panel-heading">
                            <h3 class="panel-title">core_kernel_classes_DbWrapper</h3>
                        </div>
                        <div class="panel-body">
                            <ul class="nav nav-tabs" role="tablist">
                                <li role="presentation" class="active"><a href="#instances" role="tab" data-toggle="tab">By instances :</a></li>
                                <li role="presentation"><a href="#methods" role="tab" data-toggle="tab">By Methods :</a></li>
                            </ul>
                        </div>
                        <!-- Tab panes -->
                        <div class="tab-content">
                            <div role="tabpanel" class="tab-pane active" id="instances">
                                

<div class="panel panel-info">
    <div class="panel-heading">
        <h3 class="panel-title">Instance : 000000000d429b0a000000007cbea637 (n/a)</h3>
    </div>
    <div class="panel-body">
        
            <div class="panel panel-danger">
            <div class="panel-heading">
                <h3 class="panel-title">Method : core_kernel_classes_DbWrapper::query : 192/118 (61.46%)</h3>
            </div>
            <div class="panel-body">

                                <div class="panel-group" id="accordion-method-548f1e1cf2f47" role="tablist" aria-multiselectable="true">

                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading17404f4056752363312989c79113dfd6-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#17404f4056752363312989c79113dfd6-call-548f1e1cf2f47" aria-expanded="false" aria-controls="17404f4056752363312989c79113dfd6-call-548f1e1cf2f47">
                                    Call #1 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="17404f4056752363312989c79113dfd6-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading17404f4056752363312989c79113dfd6-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading17404f4056752363312989c79113dfd6-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#17404f4056752363312989c79113dfd6-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="17404f4056752363312989c79113dfd6-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="17404f4056752363312989c79113dfd6-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading17404f4056752363312989c79113dfd6-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object FROM statements WHERE subject = ?  AND predicate = ?
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#User
            [1] => http://www.w3.org/2000/01/rdf-schema#subClassOf
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(tao/actions/form\rclass.Instance.php::99\rgetClassProperties)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::187\rgetParentClasses)-1>(generis/core/kernel/classes\rclass.Class.php::95\rgetParentClasses),(tao/actions/form\rclass.Instance.php::99\rgetClassProperties)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::169\rgetParentClasses)-1>(generis/core/kernel/classes\rclass.Class.php::95\rgetParentClasses)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (108)]</li>
                <li>&nbsp;&nbsp; => getParentClasses [/var/www/generis/core/kernel/classes/class.Class.php (95)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1cf3313" aria-expanded="false" aria-controls="trace-id-548f1e1cf3313">
                        getParentClasses [/var/www/tao/helpers/form/class.GenerisFormFactory.php (187)]
                    </a>
                                        <div id="trace-id-548f1e1cf3313" class="collapse">
                        <style>
                            .classtrace-id-548f1e1cf3313 li:nth-child(46 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1cf3313 prettyprint linenums:142 linenums">    public static function getClassProperties( core_kernel_classes_Class $clazz,  core_kernel_classes_Class $topLevelClazz = null)
    {
        $returnValue = array();

        
		
		 
        if(is_null($topLevelClazz)){
			$topLevelClazz = new core_kernel_classes_Class(TAO_OBJECT_CLASS);
		}
		
		
		if($clazz->getUri() == $topLevelClazz->getUri()){
			$returnValue = $clazz->getProperties(false);
			return (array) $returnValue;
		}
		
		//determine the parent path
		$parents = array();
		$top = false;
		do{
			if(!isset($lastLevelParents)){
				$parentClasses = $clazz->getParentClasses(false);
			}
			else{
				$parentClasses = array();
				foreach($lastLevelParents as $parent){
					$parentClasses = array_merge($parentClasses, $parent->getParentClasses(false));
				}
			}
			if(count($parentClasses) == 0){
				break;
			}
			$lastLevelParents = array();
			foreach($parentClasses as $parentClass){
				if($parentClass->getUri() == RDFS_CLASS){
					continue;
				}
				if($parentClass->getUri() == $topLevelClazz->getUri() ) {
					$parents[$parentClass->getUri()] = $parentClass;	
					$top = true;
					break;
				}
				
				
				$allParentClasses = $parentClass->getParentClasses(true);
				if(array_key_exists($topLevelClazz->getUri(), $allParentClasses)){
					 $parents[$parentClass->getUri()] = $parentClass;
				}
				
				$lastLevelParents[$parentClass->getUri()] = $parentClass;
			}
		}while(!$top);
		
		foreach($parents as $parent){
			$returnValue = array_merge($returnValue, $parent->getProperties(false));
    	}
    	$returnValue = array_merge($returnValue, $clazz->getProperties(false));
		
        

        return (array) $returnValue;
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1cf37ac" aria-expanded="false" aria-controls="trace-id-548f1e1cf37ac">
                        getParentClasses [/var/www/tao/helpers/form/class.GenerisFormFactory.php (169)]
                    </a>
                                        <div id="trace-id-548f1e1cf37ac" class="collapse">
                        <style>
                            .classtrace-id-548f1e1cf37ac li:nth-child(28 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1cf37ac prettyprint linenums:142 linenums">    public static function getClassProperties( core_kernel_classes_Class $clazz,  core_kernel_classes_Class $topLevelClazz = null)
    {
        $returnValue = array();

        
		
		 
        if(is_null($topLevelClazz)){
			$topLevelClazz = new core_kernel_classes_Class(TAO_OBJECT_CLASS);
		}
		
		
		if($clazz->getUri() == $topLevelClazz->getUri()){
			$returnValue = $clazz->getProperties(false);
			return (array) $returnValue;
		}
		
		//determine the parent path
		$parents = array();
		$top = false;
		do{
			if(!isset($lastLevelParents)){
				$parentClasses = $clazz->getParentClasses(false);
			}
			else{
				$parentClasses = array();
				foreach($lastLevelParents as $parent){
					$parentClasses = array_merge($parentClasses, $parent->getParentClasses(false));
				}
			}
			if(count($parentClasses) == 0){
				break;
			}
			$lastLevelParents = array();
			foreach($parentClasses as $parentClass){
				if($parentClass->getUri() == RDFS_CLASS){
					continue;
				}
				if($parentClass->getUri() == $topLevelClazz->getUri() ) {
					$parents[$parentClass->getUri()] = $parentClass;	
					$top = true;
					break;
				}
				
				
				$allParentClasses = $parentClass->getParentClasses(true);
				if(array_key_exists($topLevelClazz->getUri(), $allParentClasses)){
					 $parents[$parentClass->getUri()] = $parentClass;
				}
				
				$lastLevelParents[$parentClass->getUri()] = $parentClass;
			}
		}while(!$top);
		
		foreach($parents as $parent){
			$returnValue = array_merge($returnValue, $parent->getProperties(false));
    	}
    	$returnValue = array_merge($returnValue, $clazz->getProperties(false));
		
        

        return (array) $returnValue;
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => getClassProperties [/var/www/tao/actions/form/class.Instance.php (99)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/actions/form/class.Users.php (160)]</li>
                <li>&nbsp;&nbsp;&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading35f95d9da9dc35f8f091277d5987dcac-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#35f95d9da9dc35f8f091277d5987dcac-call-548f1e1cf2f47" aria-expanded="false" aria-controls="35f95d9da9dc35f8f091277d5987dcac-call-548f1e1cf2f47">
                                    Call #2 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="35f95d9da9dc35f8f091277d5987dcac-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading35f95d9da9dc35f8f091277d5987dcac-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading35f95d9da9dc35f8f091277d5987dcac-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#35f95d9da9dc35f8f091277d5987dcac-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="35f95d9da9dc35f8f091277d5987dcac-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="35f95d9da9dc35f8f091277d5987dcac-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading35f95d9da9dc35f8f091277d5987dcac-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT subject FROM statements WHERE predicate = ? and object  = ?
    [1] => Array
        (
            [0] => http://www.w3.org/2000/01/rdf-schema#subClassOf
            [1] => http://www.tao.lu/Ontologies/TAO.rdf#Languages
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(generis/core/kernel/persistence/smoothsql\rclass.Class.php::48\rquery)-2>(taoTestTaker\rindex.php::0\r{main})">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (48)]</li>
                <li>&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (508)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getFilteredQuery [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (172)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => elementMap [/var/www/tao/actions/form/class.Instance.php (128)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/tao/actions/form/class.Users.php (160)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 2</span>
        <ul>
        This trace is completely contained in starting and ending parts.        </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingde480c2280ecf632fe3a9b1bdd0f03c5-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#de480c2280ecf632fe3a9b1bdd0f03c5-call-548f1e1cf2f47" aria-expanded="false" aria-controls="de480c2280ecf632fe3a9b1bdd0f03c5-call-548f1e1cf2f47">
                                    Call #3 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="de480c2280ecf632fe3a9b1bdd0f03c5-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingde480c2280ecf632fe3a9b1bdd0f03c5-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingde480c2280ecf632fe3a9b1bdd0f03c5-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#de480c2280ecf632fe3a9b1bdd0f03c5-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="de480c2280ecf632fe3a9b1bdd0f03c5-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="de480c2280ecf632fe3a9b1bdd0f03c5-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingde480c2280ecf632fe3a9b1bdd0f03c5-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT DISTINCT subject FROM statements WHERE (predicate = 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type') AND (object = 'http://www.tao.lu/Ontologies/TAO.rdf#Languages')
)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(generis/core/kernel/persistence/smoothsql\rclass.Class.php::173\rquery)-2>(taoTestTaker\rindex.php::0\r{main})">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (173)]</li>
                <li>&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => elementMap [/var/www/tao/actions/form/class.Instance.php (128)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/tao/actions/form/class.Users.php (160)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 2</span>
        <ul>
        This trace is completely contained in starting and ending parts.        </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headinga5ab419a811020a9dc88839e86e5af2e-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#a5ab419a811020a9dc88839e86e5af2e-call-548f1e1cf2f47" aria-expanded="false" aria-controls="a5ab419a811020a9dc88839e86e5af2e-call-548f1e1cf2f47">
                                    Call #4 (6 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="a5ab419a811020a9dc88839e86e5af2e-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headinga5ab419a811020a9dc88839e86e5af2e-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headinga5ab419a811020a9dc88839e86e5af2e-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#a5ab419a811020a9dc88839e86e5af2e-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="a5ab419a811020a9dc88839e86e5af2e-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="a5ab419a811020a9dc88839e86e5af2e-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headinga5ab419a811020a9dc88839e86e5af2e-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#Langda-DK
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-4>(tao/actions/form\rclass.Users.php::160\rinitElements)-4>(tao/actions/form\rclass.Instance.php::128\relementMap)-4>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-4>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::189\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::199\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 4</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d001ae" aria-expanded="false" aria-controls="trace-id-548f1e1d001ae">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d001ae" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d001ae li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d001ae prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d005bd" aria-expanded="false" aria-controls="trace-id-548f1e1d005bd">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d005bd" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d005bd li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d005bd prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d00c6a" aria-expanded="false" aria-controls="trace-id-548f1e1d00c6a">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d00c6a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d00c6a li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d00c6a prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0145a" aria-expanded="false" aria-controls="trace-id-548f1e1d0145a">
                        getLabel [/var/www/tao/actions/form/class.Users.php (189)]
                    </a>
                                        <div id="trace-id-548f1e1d0145a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0145a li:nth-child(38 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0145a prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d01ab4" aria-expanded="false" aria-controls="trace-id-548f1e1d01ab4">
                        getLabel [/var/www/tao/actions/form/class.Users.php (199)]
                    </a>
                                        <div id="trace-id-548f1e1d01ab4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d01ab4 li:nth-child(48 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d01ab4 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingaf83c295edb9fffb06de799ac95181bb-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#af83c295edb9fffb06de799ac95181bb-call-548f1e1cf2f47" aria-expanded="false" aria-controls="af83c295edb9fffb06de799ac95181bb-call-548f1e1cf2f47">
                                    Call #5 (6 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="af83c295edb9fffb06de799ac95181bb-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingaf83c295edb9fffb06de799ac95181bb-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingaf83c295edb9fffb06de799ac95181bb-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#af83c295edb9fffb06de799ac95181bb-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="af83c295edb9fffb06de799ac95181bb-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="af83c295edb9fffb06de799ac95181bb-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingaf83c295edb9fffb06de799ac95181bb-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#Langen-US
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-4>(tao/actions/form\rclass.Users.php::160\rinitElements)-4>(tao/actions/form\rclass.Instance.php::128\relementMap)-4>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-4>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::189\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::199\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 4</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0268c" aria-expanded="false" aria-controls="trace-id-548f1e1d0268c">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d0268c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0268c li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0268c prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d02a63" aria-expanded="false" aria-controls="trace-id-548f1e1d02a63">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d02a63" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d02a63 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d02a63 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d02fea" aria-expanded="false" aria-controls="trace-id-548f1e1d02fea">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d02fea" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d02fea li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d02fea prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d03690" aria-expanded="false" aria-controls="trace-id-548f1e1d03690">
                        getLabel [/var/www/tao/actions/form/class.Users.php (189)]
                    </a>
                                        <div id="trace-id-548f1e1d03690" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d03690 li:nth-child(38 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d03690 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d03e61" aria-expanded="false" aria-controls="trace-id-548f1e1d03e61">
                        getLabel [/var/www/tao/actions/form/class.Users.php (199)]
                    </a>
                                        <div id="trace-id-548f1e1d03e61" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d03e61 li:nth-child(48 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d03e61 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingc83c9e7643542967fd7f15c4addb9b5d-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#c83c9e7643542967fd7f15c4addb9b5d-call-548f1e1cf2f47" aria-expanded="false" aria-controls="c83c9e7643542967fd7f15c4addb9b5d-call-548f1e1cf2f47">
                                    Call #6 (6 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="c83c9e7643542967fd7f15c4addb9b5d-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingc83c9e7643542967fd7f15c4addb9b5d-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingc83c9e7643542967fd7f15c4addb9b5d-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#c83c9e7643542967fd7f15c4addb9b5d-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="c83c9e7643542967fd7f15c4addb9b5d-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="c83c9e7643542967fd7f15c4addb9b5d-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingc83c9e7643542967fd7f15c4addb9b5d-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#Langfr-FR
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-4>(tao/actions/form\rclass.Users.php::160\rinitElements)-4>(tao/actions/form\rclass.Instance.php::128\relementMap)-4>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-4>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::189\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::199\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 4</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d04aa1" aria-expanded="false" aria-controls="trace-id-548f1e1d04aa1">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d04aa1" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d04aa1 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d04aa1 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d04f17" aria-expanded="false" aria-controls="trace-id-548f1e1d04f17">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d04f17" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d04f17 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d04f17 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d057b6" aria-expanded="false" aria-controls="trace-id-548f1e1d057b6">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d057b6" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d057b6 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d057b6 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d05e41" aria-expanded="false" aria-controls="trace-id-548f1e1d05e41">
                        getLabel [/var/www/tao/actions/form/class.Users.php (189)]
                    </a>
                                        <div id="trace-id-548f1e1d05e41" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d05e41 li:nth-child(38 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d05e41 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d064f0" aria-expanded="false" aria-controls="trace-id-548f1e1d064f0">
                        getLabel [/var/www/tao/actions/form/class.Users.php (199)]
                    </a>
                                        <div id="trace-id-548f1e1d064f0" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d064f0 li:nth-child(48 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d064f0 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingdfa5747b0d101d9f7d07bcf98a5d73c4-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#dfa5747b0d101d9f7d07bcf98a5d73c4-call-548f1e1cf2f47" aria-expanded="false" aria-controls="dfa5747b0d101d9f7d07bcf98a5d73c4-call-548f1e1cf2f47">
                                    Call #7 (6 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="dfa5747b0d101d9f7d07bcf98a5d73c4-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingdfa5747b0d101d9f7d07bcf98a5d73c4-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingdfa5747b0d101d9f7d07bcf98a5d73c4-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#dfa5747b0d101d9f7d07bcf98a5d73c4-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="dfa5747b0d101d9f7d07bcf98a5d73c4-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="dfa5747b0d101d9f7d07bcf98a5d73c4-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingdfa5747b0d101d9f7d07bcf98a5d73c4-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#Langpt-PT
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-4>(tao/actions/form\rclass.Users.php::160\rinitElements)-4>(tao/actions/form\rclass.Instance.php::128\relementMap)-4>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-4>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::189\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::199\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 4</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d070f6" aria-expanded="false" aria-controls="trace-id-548f1e1d070f6">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d070f6" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d070f6 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d070f6 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d074f2" aria-expanded="false" aria-controls="trace-id-548f1e1d074f2">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d074f2" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d074f2 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d074f2 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d07a51" aria-expanded="false" aria-controls="trace-id-548f1e1d07a51">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d07a51" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d07a51 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d07a51 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d080ff" aria-expanded="false" aria-controls="trace-id-548f1e1d080ff">
                        getLabel [/var/www/tao/actions/form/class.Users.php (189)]
                    </a>
                                        <div id="trace-id-548f1e1d080ff" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d080ff li:nth-child(38 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d080ff prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0877f" aria-expanded="false" aria-controls="trace-id-548f1e1d0877f">
                        getLabel [/var/www/tao/actions/form/class.Users.php (199)]
                    </a>
                                        <div id="trace-id-548f1e1d0877f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0877f li:nth-child(48 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0877f prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading844c4c19b8853e8013283c4a49b73590-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#844c4c19b8853e8013283c4a49b73590-call-548f1e1cf2f47" aria-expanded="false" aria-controls="844c4c19b8853e8013283c4a49b73590-call-548f1e1cf2f47">
                                    Call #8 (6 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="844c4c19b8853e8013283c4a49b73590-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading844c4c19b8853e8013283c4a49b73590-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading844c4c19b8853e8013283c4a49b73590-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#844c4c19b8853e8013283c4a49b73590-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="844c4c19b8853e8013283c4a49b73590-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="844c4c19b8853e8013283c4a49b73590-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading844c4c19b8853e8013283c4a49b73590-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#Langsv-SE
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-4>(tao/actions/form\rclass.Users.php::160\rinitElements)-4>(tao/actions/form\rclass.Instance.php::128\relementMap)-4>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-4>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::189\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::199\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 4</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d093c5" aria-expanded="false" aria-controls="trace-id-548f1e1d093c5">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d093c5" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d093c5 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d093c5 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d097db" aria-expanded="false" aria-controls="trace-id-548f1e1d097db">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d097db" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d097db li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d097db prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d09d00" aria-expanded="false" aria-controls="trace-id-548f1e1d09d00">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d09d00" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d09d00 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d09d00 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0a358" aria-expanded="false" aria-controls="trace-id-548f1e1d0a358">
                        getLabel [/var/www/tao/actions/form/class.Users.php (189)]
                    </a>
                                        <div id="trace-id-548f1e1d0a358" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0a358 li:nth-child(38 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0a358 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0aa11" aria-expanded="false" aria-controls="trace-id-548f1e1d0aa11">
                        getLabel [/var/www/tao/actions/form/class.Users.php (199)]
                    </a>
                                        <div id="trace-id-548f1e1d0aa11" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0aa11 li:nth-child(48 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0aa11 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading64469fb082b0b741efcae70afc7fc6ff-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#64469fb082b0b741efcae70afc7fc6ff-call-548f1e1cf2f47" aria-expanded="false" aria-controls="64469fb082b0b741efcae70afc7fc6ff-call-548f1e1cf2f47">
                                    Call #9 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="64469fb082b0b741efcae70afc7fc6ff-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading64469fb082b0b741efcae70afc7fc6ff-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading64469fb082b0b741efcae70afc7fc6ff-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#64469fb082b0b741efcae70afc7fc6ff-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="64469fb082b0b741efcae70afc7fc6ff-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="64469fb082b0b741efcae70afc7fc6ff-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading64469fb082b0b741efcae70afc7fc6ff-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT subject FROM statements WHERE predicate = ? and object  = ?
    [1] => Array
        (
            [0] => http://www.w3.org/2000/01/rdf-schema#subClassOf
            [1] => http://www.tao.lu/Ontologies/generis.rdf#ClassRole
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::110\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::206\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (48)]</li>
                <li>&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (508)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getFilteredQuery [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (172)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0b6a4" aria-expanded="false" aria-controls="trace-id-548f1e1d0b6a4">
                        getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]
                    </a>
                                        <div id="trace-id-548f1e1d0b6a4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0b6a4 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0b6a4 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0baa4" aria-expanded="false" aria-controls="trace-id-548f1e1d0baa4">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d0baa4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0baa4 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0baa4 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0c06e" aria-expanded="false" aria-controls="trace-id-548f1e1d0c06e">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d0c06e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0c06e li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0c06e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0c71f" aria-expanded="false" aria-controls="trace-id-548f1e1d0c71f">
                        getInstances [/var/www/tao/actions/form/class.Users.php (206)]
                    </a>
                                        <div id="trace-id-548f1e1d0c71f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0c71f li:nth-child(55 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0c71f prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading58c61738e419da9fa368e1ee27491cca-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#58c61738e419da9fa368e1ee27491cca-call-548f1e1cf2f47" aria-expanded="false" aria-controls="58c61738e419da9fa368e1ee27491cca-call-548f1e1cf2f47">
                                    Call #10 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="58c61738e419da9fa368e1ee27491cca-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading58c61738e419da9fa368e1ee27491cca-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading58c61738e419da9fa368e1ee27491cca-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#58c61738e419da9fa368e1ee27491cca-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="58c61738e419da9fa368e1ee27491cca-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="58c61738e419da9fa368e1ee27491cca-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading58c61738e419da9fa368e1ee27491cca-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT subject FROM statements WHERE predicate = ? and object  = ?
    [1] => Array
        (
            [0] => http://www.w3.org/2000/01/rdf-schema#subClassOf
            [1] => http://www.tao.lu/Ontologies/generis.rdf#AbstractRole
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::110\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::206\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (48)]</li>
                <li>&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/classes/class.Class.php (69)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (54)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (508)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getFilteredQuery [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (172)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0d1cf" aria-expanded="false" aria-controls="trace-id-548f1e1d0d1cf">
                        getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]
                    </a>
                                        <div id="trace-id-548f1e1d0d1cf" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0d1cf li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0d1cf prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0d627" aria-expanded="false" aria-controls="trace-id-548f1e1d0d627">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d0d627" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0d627 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0d627 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0dc08" aria-expanded="false" aria-controls="trace-id-548f1e1d0dc08">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d0dc08" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0dc08 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0dc08 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0e22b" aria-expanded="false" aria-controls="trace-id-548f1e1d0e22b">
                        getInstances [/var/www/tao/actions/form/class.Users.php (206)]
                    </a>
                                        <div id="trace-id-548f1e1d0e22b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0e22b li:nth-child(55 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0e22b prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingc977df3d4308e9361507c92c00a793cd-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#c977df3d4308e9361507c92c00a793cd-call-548f1e1cf2f47" aria-expanded="false" aria-controls="c977df3d4308e9361507c92c00a793cd-call-548f1e1cf2f47">
                                    Call #11 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="c977df3d4308e9361507c92c00a793cd-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingc977df3d4308e9361507c92c00a793cd-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingc977df3d4308e9361507c92c00a793cd-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#c977df3d4308e9361507c92c00a793cd-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="c977df3d4308e9361507c92c00a793cd-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="c977df3d4308e9361507c92c00a793cd-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingc977df3d4308e9361507c92c00a793cd-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT subject FROM statements WHERE predicate = ? and object  = ?
    [1] => Array
        (
            [0] => http://www.w3.org/2000/01/rdf-schema#subClassOf
            [1] => http://www.tao.lu/Ontologies/TAO.rdf#ManagementRole
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::110\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::206\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (48)]</li>
                <li>&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/classes/class.Class.php (69)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (54)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (508)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getFilteredQuery [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (172)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0ecc1" aria-expanded="false" aria-controls="trace-id-548f1e1d0ecc1">
                        getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]
                    </a>
                                        <div id="trace-id-548f1e1d0ecc1" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0ecc1 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0ecc1 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0f2c6" aria-expanded="false" aria-controls="trace-id-548f1e1d0f2c6">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d0f2c6" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0f2c6 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0f2c6 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0f838" aria-expanded="false" aria-controls="trace-id-548f1e1d0f838">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d0f838" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0f838 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0f838 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d0ff26" aria-expanded="false" aria-controls="trace-id-548f1e1d0ff26">
                        getInstances [/var/www/tao/actions/form/class.Users.php (206)]
                    </a>
                                        <div id="trace-id-548f1e1d0ff26" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d0ff26 li:nth-child(55 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d0ff26 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingb8642f18978944d459791e01fce4ca21-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#b8642f18978944d459791e01fce4ca21-call-548f1e1cf2f47" aria-expanded="false" aria-controls="b8642f18978944d459791e01fce4ca21-call-548f1e1cf2f47">
                                    Call #12 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="b8642f18978944d459791e01fce4ca21-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingb8642f18978944d459791e01fce4ca21-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingb8642f18978944d459791e01fce4ca21-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#b8642f18978944d459791e01fce4ca21-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="b8642f18978944d459791e01fce4ca21-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="b8642f18978944d459791e01fce4ca21-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingb8642f18978944d459791e01fce4ca21-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT subject FROM statements WHERE predicate = ? and object  = ?
    [1] => Array
        (
            [0] => http://www.w3.org/2000/01/rdf-schema#subClassOf
            [1] => http://www.tao.lu/Ontologies/TAO.rdf#WorkerRole
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::110\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::206\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (48)]</li>
                <li>&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/classes/class.Class.php (69)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (54)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (508)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getFilteredQuery [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (172)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d10a14" aria-expanded="false" aria-controls="trace-id-548f1e1d10a14">
                        getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]
                    </a>
                                        <div id="trace-id-548f1e1d10a14" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d10a14 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d10a14 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d10e69" aria-expanded="false" aria-controls="trace-id-548f1e1d10e69">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d10e69" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d10e69 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d10e69 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d11459" aria-expanded="false" aria-controls="trace-id-548f1e1d11459">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d11459" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d11459 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d11459 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d11ae7" aria-expanded="false" aria-controls="trace-id-548f1e1d11ae7">
                        getInstances [/var/www/tao/actions/form/class.Users.php (206)]
                    </a>
                                        <div id="trace-id-548f1e1d11ae7" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d11ae7 li:nth-child(55 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d11ae7 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading5b7043ebeb16efc4b7139fe4b1a6912c-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#5b7043ebeb16efc4b7139fe4b1a6912c-call-548f1e1cf2f47" aria-expanded="false" aria-controls="5b7043ebeb16efc4b7139fe4b1a6912c-call-548f1e1cf2f47">
                                    Call #13 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="5b7043ebeb16efc4b7139fe4b1a6912c-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading5b7043ebeb16efc4b7139fe4b1a6912c-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading5b7043ebeb16efc4b7139fe4b1a6912c-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#5b7043ebeb16efc4b7139fe4b1a6912c-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="5b7043ebeb16efc4b7139fe4b1a6912c-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="5b7043ebeb16efc4b7139fe4b1a6912c-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading5b7043ebeb16efc4b7139fe4b1a6912c-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT DISTINCT subject FROM statements WHERE (predicate = 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type') AND (object = 'http://www.tao.lu/Ontologies/generis.rdf#AbstractRole' OR object = 'http://www.tao.lu/Ontologies/TAO.rdf#ManagementRole' OR object = 'http://www.tao.lu/Ontologies/TAO.rdf#WorkerRole' OR object = 'http://www.tao.lu/Ontologies/generis.rdf#ClassRole')
)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::110\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::206\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (173)]</li>
                <li>&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d124ac" aria-expanded="false" aria-controls="trace-id-548f1e1d124ac">
                        getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]
                    </a>
                                        <div id="trace-id-548f1e1d124ac" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d124ac li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d124ac prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1285b" aria-expanded="false" aria-controls="trace-id-548f1e1d1285b">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d1285b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1285b li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1285b prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d12df1" aria-expanded="false" aria-controls="trace-id-548f1e1d12df1">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d12df1" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d12df1 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d12df1 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d13461" aria-expanded="false" aria-controls="trace-id-548f1e1d13461">
                        getInstances [/var/www/tao/actions/form/class.Users.php (206)]
                    </a>
                                        <div id="trace-id-548f1e1d13461" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d13461 li:nth-child(55 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d13461 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading2dc54e97ecbc631ec3098645dce2bf05-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#2dc54e97ecbc631ec3098645dce2bf05-call-548f1e1cf2f47" aria-expanded="false" aria-controls="2dc54e97ecbc631ec3098645dce2bf05-call-548f1e1cf2f47">
                                    Call #14 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="2dc54e97ecbc631ec3098645dce2bf05-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading2dc54e97ecbc631ec3098645dce2bf05-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading2dc54e97ecbc631ec3098645dce2bf05-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#2dc54e97ecbc631ec3098645dce2bf05-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="2dc54e97ecbc631ec3098645dce2bf05-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="2dc54e97ecbc631ec3098645dce2bf05-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading2dc54e97ecbc631ec3098645dce2bf05-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/generis.rdf#GenerisRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d13eae" aria-expanded="false" aria-controls="trace-id-548f1e1d13eae">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d13eae" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d13eae li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d13eae prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d142e3" aria-expanded="false" aria-controls="trace-id-548f1e1d142e3">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d142e3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d142e3 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d142e3 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d14882" aria-expanded="false" aria-controls="trace-id-548f1e1d14882">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d14882" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d14882 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d14882 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d14f81" aria-expanded="false" aria-controls="trace-id-548f1e1d14f81">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d14f81" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d14f81 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d14f81 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading4f1a156390f23bf0f3778e112254038a-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#4f1a156390f23bf0f3778e112254038a-call-548f1e1cf2f47" aria-expanded="false" aria-controls="4f1a156390f23bf0f3778e112254038a-call-548f1e1cf2f47">
                                    Call #15 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="4f1a156390f23bf0f3778e112254038a-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading4f1a156390f23bf0f3778e112254038a-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading4f1a156390f23bf0f3778e112254038a-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#4f1a156390f23bf0f3778e112254038a-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="4f1a156390f23bf0f3778e112254038a-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="4f1a156390f23bf0f3778e112254038a-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading4f1a156390f23bf0f3778e112254038a-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/generis.rdf#AnonymousRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d159fa" aria-expanded="false" aria-controls="trace-id-548f1e1d159fa">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d159fa" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d159fa li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d159fa prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d15f17" aria-expanded="false" aria-controls="trace-id-548f1e1d15f17">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d15f17" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d15f17 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d15f17 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d164a6" aria-expanded="false" aria-controls="trace-id-548f1e1d164a6">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d164a6" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d164a6 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d164a6 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d16afc" aria-expanded="false" aria-controls="trace-id-548f1e1d16afc">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d16afc" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d16afc li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d16afc prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading5a589bb7de53a1ea0004b092ae5eb42b-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#5a589bb7de53a1ea0004b092ae5eb42b-call-548f1e1cf2f47" aria-expanded="false" aria-controls="5a589bb7de53a1ea0004b092ae5eb42b-call-548f1e1cf2f47">
                                    Call #16 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="5a589bb7de53a1ea0004b092ae5eb42b-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading5a589bb7de53a1ea0004b092ae5eb42b-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading5a589bb7de53a1ea0004b092ae5eb42b-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#5a589bb7de53a1ea0004b092ae5eb42b-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="5a589bb7de53a1ea0004b092ae5eb42b-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="5a589bb7de53a1ea0004b092ae5eb42b-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading5a589bb7de53a1ea0004b092ae5eb42b-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#BackOfficeRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d174c3" aria-expanded="false" aria-controls="trace-id-548f1e1d174c3">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d174c3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d174c3 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d174c3 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d178b7" aria-expanded="false" aria-controls="trace-id-548f1e1d178b7">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d178b7" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d178b7 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d178b7 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d17e1e" aria-expanded="false" aria-controls="trace-id-548f1e1d17e1e">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d17e1e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d17e1e li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d17e1e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1852e" aria-expanded="false" aria-controls="trace-id-548f1e1d1852e">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d1852e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1852e li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1852e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading6cf732553a98025bc5316b7172a41421-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#6cf732553a98025bc5316b7172a41421-call-548f1e1cf2f47" aria-expanded="false" aria-controls="6cf732553a98025bc5316b7172a41421-call-548f1e1cf2f47">
                                    Call #17 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="6cf732553a98025bc5316b7172a41421-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading6cf732553a98025bc5316b7172a41421-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading6cf732553a98025bc5316b7172a41421-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#6cf732553a98025bc5316b7172a41421-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="6cf732553a98025bc5316b7172a41421-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="6cf732553a98025bc5316b7172a41421-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading6cf732553a98025bc5316b7172a41421-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#FrontOfficeRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d18fea" aria-expanded="false" aria-controls="trace-id-548f1e1d18fea">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d18fea" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d18fea li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d18fea prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1947a" aria-expanded="false" aria-controls="trace-id-548f1e1d1947a">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d1947a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1947a li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1947a prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d19a76" aria-expanded="false" aria-controls="trace-id-548f1e1d19a76">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d19a76" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d19a76 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d19a76 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1a4cb" aria-expanded="false" aria-controls="trace-id-548f1e1d1a4cb">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d1a4cb" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1a4cb li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1a4cb prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading4f00f6e767f1e4ad5ce7e7768a13db53-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#4f00f6e767f1e4ad5ce7e7768a13db53-call-548f1e1cf2f47" aria-expanded="false" aria-controls="4f00f6e767f1e4ad5ce7e7768a13db53-call-548f1e1cf2f47">
                                    Call #18 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="4f00f6e767f1e4ad5ce7e7768a13db53-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading4f00f6e767f1e4ad5ce7e7768a13db53-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading4f00f6e767f1e4ad5ce7e7768a13db53-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#4f00f6e767f1e4ad5ce7e7768a13db53-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="4f00f6e767f1e4ad5ce7e7768a13db53-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="4f00f6e767f1e4ad5ce7e7768a13db53-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading4f00f6e767f1e4ad5ce7e7768a13db53-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#ServiceRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1af3b" aria-expanded="false" aria-controls="trace-id-548f1e1d1af3b">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d1af3b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1af3b li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1af3b prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1b309" aria-expanded="false" aria-controls="trace-id-548f1e1d1b309">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d1b309" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1b309 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1b309 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1b875" aria-expanded="false" aria-controls="trace-id-548f1e1d1b875">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d1b875" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1b875 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1b875 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1bf17" aria-expanded="false" aria-controls="trace-id-548f1e1d1bf17">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d1bf17" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1bf17 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1bf17 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading684add7acb4cc390c59024491e36894d-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#684add7acb4cc390c59024491e36894d-call-548f1e1cf2f47" aria-expanded="false" aria-controls="684add7acb4cc390c59024491e36894d-call-548f1e1cf2f47">
                                    Call #19 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="684add7acb4cc390c59024491e36894d-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading684add7acb4cc390c59024491e36894d-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading684add7acb4cc390c59024491e36894d-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#684add7acb4cc390c59024491e36894d-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="684add7acb4cc390c59024491e36894d-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="684add7acb4cc390c59024491e36894d-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading684add7acb4cc390c59024491e36894d-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#BaseUserRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1c906" aria-expanded="false" aria-controls="trace-id-548f1e1d1c906">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d1c906" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1c906 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1c906 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1ce77" aria-expanded="false" aria-controls="trace-id-548f1e1d1ce77">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d1ce77" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1ce77 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1ce77 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1d454" aria-expanded="false" aria-controls="trace-id-548f1e1d1d454">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d1d454" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1d454 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1d454 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1db36" aria-expanded="false" aria-controls="trace-id-548f1e1d1db36">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d1db36" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1db36 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1db36 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading684bc6eefd3d5ab5c804e5094700b668-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#684bc6eefd3d5ab5c804e5094700b668-call-548f1e1cf2f47" aria-expanded="false" aria-controls="684bc6eefd3d5ab5c804e5094700b668-call-548f1e1cf2f47">
                                    Call #20 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="684bc6eefd3d5ab5c804e5094700b668-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading684bc6eefd3d5ab5c804e5094700b668-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading684bc6eefd3d5ab5c804e5094700b668-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#684bc6eefd3d5ab5c804e5094700b668-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="684bc6eefd3d5ab5c804e5094700b668-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="684bc6eefd3d5ab5c804e5094700b668-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading684bc6eefd3d5ab5c804e5094700b668-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#subRole13
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1e597" aria-expanded="false" aria-controls="trace-id-548f1e1d1e597">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d1e597" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1e597 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1e597 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1e934" aria-expanded="false" aria-controls="trace-id-548f1e1d1e934">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d1e934" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1e934 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1e934 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1f041" aria-expanded="false" aria-controls="trace-id-548f1e1d1f041">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d1f041" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1f041 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1f041 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d1f6c6" aria-expanded="false" aria-controls="trace-id-548f1e1d1f6c6">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d1f6c6" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d1f6c6 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d1f6c6 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading4e3882d72cb4a01e1001e7cb88b429a1-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#4e3882d72cb4a01e1001e7cb88b429a1-call-548f1e1cf2f47" aria-expanded="false" aria-controls="4e3882d72cb4a01e1001e7cb88b429a1-call-548f1e1cf2f47">
                                    Call #21 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="4e3882d72cb4a01e1001e7cb88b429a1-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading4e3882d72cb4a01e1001e7cb88b429a1-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading4e3882d72cb4a01e1001e7cb88b429a1-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#4e3882d72cb4a01e1001e7cb88b429a1-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="4e3882d72cb4a01e1001e7cb88b429a1-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="4e3882d72cb4a01e1001e7cb88b429a1-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading4e3882d72cb4a01e1001e7cb88b429a1-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#subRole2
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d201f2" aria-expanded="false" aria-controls="trace-id-548f1e1d201f2">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d201f2" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d201f2 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d201f2 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d205e1" aria-expanded="false" aria-controls="trace-id-548f1e1d205e1">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d205e1" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d205e1 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d205e1 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d20dcc" aria-expanded="false" aria-controls="trace-id-548f1e1d20dcc">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d20dcc" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d20dcc li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d20dcc prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d21514" aria-expanded="false" aria-controls="trace-id-548f1e1d21514">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d21514" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d21514 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d21514 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingf71c525d28da2b363fa431a6586e1b9c-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#f71c525d28da2b363fa431a6586e1b9c-call-548f1e1cf2f47" aria-expanded="false" aria-controls="f71c525d28da2b363fa431a6586e1b9c-call-548f1e1cf2f47">
                                    Call #22 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="f71c525d28da2b363fa431a6586e1b9c-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingf71c525d28da2b363fa431a6586e1b9c-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingf71c525d28da2b363fa431a6586e1b9c-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#f71c525d28da2b363fa431a6586e1b9c-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="f71c525d28da2b363fa431a6586e1b9c-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="f71c525d28da2b363fa431a6586e1b9c-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingf71c525d28da2b363fa431a6586e1b9c-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#baseRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d21f8a" aria-expanded="false" aria-controls="trace-id-548f1e1d21f8a">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d21f8a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d21f8a li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d21f8a prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d22450" aria-expanded="false" aria-controls="trace-id-548f1e1d22450">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d22450" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d22450 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d22450 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d229ec" aria-expanded="false" aria-controls="trace-id-548f1e1d229ec">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d229ec" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d229ec li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d229ec prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d23118" aria-expanded="false" aria-controls="trace-id-548f1e1d23118">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d23118" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d23118 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d23118 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingbea3fb27935490e75aae67bc16242edc-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#bea3fb27935490e75aae67bc16242edc-call-548f1e1cf2f47" aria-expanded="false" aria-controls="bea3fb27935490e75aae67bc16242edc-call-548f1e1cf2f47">
                                    Call #23 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="bea3fb27935490e75aae67bc16242edc-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingbea3fb27935490e75aae67bc16242edc-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingbea3fb27935490e75aae67bc16242edc-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#bea3fb27935490e75aae67bc16242edc-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="bea3fb27935490e75aae67bc16242edc-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="bea3fb27935490e75aae67bc16242edc-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingbea3fb27935490e75aae67bc16242edc-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#subRole12
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d23b98" aria-expanded="false" aria-controls="trace-id-548f1e1d23b98">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d23b98" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d23b98 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d23b98 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d23f82" aria-expanded="false" aria-controls="trace-id-548f1e1d23f82">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d23f82" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d23f82 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d23f82 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2454b" aria-expanded="false" aria-controls="trace-id-548f1e1d2454b">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d2454b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2454b li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2454b prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d24c10" aria-expanded="false" aria-controls="trace-id-548f1e1d24c10">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d24c10" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d24c10 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d24c10 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingd2a28b023e4de789e94c395f14015803-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#d2a28b023e4de789e94c395f14015803-call-548f1e1cf2f47" aria-expanded="false" aria-controls="d2a28b023e4de789e94c395f14015803-call-548f1e1cf2f47">
                                    Call #24 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="d2a28b023e4de789e94c395f14015803-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingd2a28b023e4de789e94c395f14015803-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingd2a28b023e4de789e94c395f14015803-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#d2a28b023e4de789e94c395f14015803-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="d2a28b023e4de789e94c395f14015803-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="d2a28b023e4de789e94c395f14015803-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingd2a28b023e4de789e94c395f14015803-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#subRole11
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2564a" aria-expanded="false" aria-controls="trace-id-548f1e1d2564a">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d2564a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2564a li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2564a prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d25a99" aria-expanded="false" aria-controls="trace-id-548f1e1d25a99">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d25a99" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d25a99 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d25a99 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d25fd8" aria-expanded="false" aria-controls="trace-id-548f1e1d25fd8">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d25fd8" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d25fd8 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d25fd8 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d265d5" aria-expanded="false" aria-controls="trace-id-548f1e1d265d5">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d265d5" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d265d5 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d265d5 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingb7178211f15f2f0643471456ceeccc3f-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#b7178211f15f2f0643471456ceeccc3f-call-548f1e1cf2f47" aria-expanded="false" aria-controls="b7178211f15f2f0643471456ceeccc3f-call-548f1e1cf2f47">
                                    Call #25 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="b7178211f15f2f0643471456ceeccc3f-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingb7178211f15f2f0643471456ceeccc3f-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingb7178211f15f2f0643471456ceeccc3f-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#b7178211f15f2f0643471456ceeccc3f-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="b7178211f15f2f0643471456ceeccc3f-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="b7178211f15f2f0643471456ceeccc3f-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingb7178211f15f2f0643471456ceeccc3f-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#subRole3
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2712e" aria-expanded="false" aria-controls="trace-id-548f1e1d2712e">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d2712e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2712e li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2712e prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2790d" aria-expanded="false" aria-controls="trace-id-548f1e1d2790d">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d2790d" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2790d li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2790d prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d281a9" aria-expanded="false" aria-controls="trace-id-548f1e1d281a9">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d281a9" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d281a9 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d281a9 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d28829" aria-expanded="false" aria-controls="trace-id-548f1e1d28829">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d28829" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d28829 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d28829 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingb5e622f73db73ed8a19161d91f6d0852-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#b5e622f73db73ed8a19161d91f6d0852-call-548f1e1cf2f47" aria-expanded="false" aria-controls="b5e622f73db73ed8a19161d91f6d0852-call-548f1e1cf2f47">
                                    Call #26 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="b5e622f73db73ed8a19161d91f6d0852-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingb5e622f73db73ed8a19161d91f6d0852-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingb5e622f73db73ed8a19161d91f6d0852-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#b5e622f73db73ed8a19161d91f6d0852-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="b5e622f73db73ed8a19161d91f6d0852-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="b5e622f73db73ed8a19161d91f6d0852-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingb5e622f73db73ed8a19161d91f6d0852-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#subRole1
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d292a0" aria-expanded="false" aria-controls="trace-id-548f1e1d292a0">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d292a0" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d292a0 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d292a0 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2975c" aria-expanded="false" aria-controls="trace-id-548f1e1d2975c">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d2975c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2975c li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2975c prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d29d4a" aria-expanded="false" aria-controls="trace-id-548f1e1d29d4a">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d29d4a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d29d4a li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d29d4a prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2a402" aria-expanded="false" aria-controls="trace-id-548f1e1d2a402">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d2a402" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2a402 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2a402 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading04f9016070eaa658a1459d3bd0bf6c2c-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#04f9016070eaa658a1459d3bd0bf6c2c-call-548f1e1cf2f47" aria-expanded="false" aria-controls="04f9016070eaa658a1459d3bd0bf6c2c-call-548f1e1cf2f47">
                                    Call #27 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="04f9016070eaa658a1459d3bd0bf6c2c-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading04f9016070eaa658a1459d3bd0bf6c2c-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading04f9016070eaa658a1459d3bd0bf6c2c-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#04f9016070eaa658a1459d3bd0bf6c2c-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="04f9016070eaa658a1459d3bd0bf6c2c-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="04f9016070eaa658a1459d3bd0bf6c2c-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading04f9016070eaa658a1459d3bd0bf6c2c-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#GlobalManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2adff" aria-expanded="false" aria-controls="trace-id-548f1e1d2adff">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d2adff" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2adff li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2adff prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2b260" aria-expanded="false" aria-controls="trace-id-548f1e1d2b260">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d2b260" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2b260 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2b260 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2b7f7" aria-expanded="false" aria-controls="trace-id-548f1e1d2b7f7">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d2b7f7" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2b7f7 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2b7f7 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2be9c" aria-expanded="false" aria-controls="trace-id-548f1e1d2be9c">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d2be9c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2be9c li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2be9c prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading08d9c4737f7fa3d8715cf4d52fa542a8-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#08d9c4737f7fa3d8715cf4d52fa542a8-call-548f1e1cf2f47" aria-expanded="false" aria-controls="08d9c4737f7fa3d8715cf4d52fa542a8-call-548f1e1cf2f47">
                                    Call #28 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="08d9c4737f7fa3d8715cf4d52fa542a8-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading08d9c4737f7fa3d8715cf4d52fa542a8-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading08d9c4737f7fa3d8715cf4d52fa542a8-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#08d9c4737f7fa3d8715cf4d52fa542a8-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="08d9c4737f7fa3d8715cf4d52fa542a8-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="08d9c4737f7fa3d8715cf4d52fa542a8-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading08d9c4737f7fa3d8715cf4d52fa542a8-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#TaoManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2c8c4" aria-expanded="false" aria-controls="trace-id-548f1e1d2c8c4">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d2c8c4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2c8c4 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2c8c4 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2ccb6" aria-expanded="false" aria-controls="trace-id-548f1e1d2ccb6">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d2ccb6" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2ccb6 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2ccb6 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2d252" aria-expanded="false" aria-controls="trace-id-548f1e1d2d252">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d2d252" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2d252 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2d252 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2d94d" aria-expanded="false" aria-controls="trace-id-548f1e1d2d94d">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d2d94d" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2d94d li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2d94d prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingb476a7c74e411049d10cb1cfeb4c7eb4-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#b476a7c74e411049d10cb1cfeb4c7eb4-call-548f1e1cf2f47" aria-expanded="false" aria-controls="b476a7c74e411049d10cb1cfeb4c7eb4-call-548f1e1cf2f47">
                                    Call #29 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="b476a7c74e411049d10cb1cfeb4c7eb4-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingb476a7c74e411049d10cb1cfeb4c7eb4-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingb476a7c74e411049d10cb1cfeb4c7eb4-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#b476a7c74e411049d10cb1cfeb4c7eb4-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="b476a7c74e411049d10cb1cfeb4c7eb4-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="b476a7c74e411049d10cb1cfeb4c7eb4-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingb476a7c74e411049d10cb1cfeb4c7eb4-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/taoFuncACL.rdf#FuncAclManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2e3eb" aria-expanded="false" aria-controls="trace-id-548f1e1d2e3eb">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d2e3eb" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2e3eb li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2e3eb prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2e854" aria-expanded="false" aria-controls="trace-id-548f1e1d2e854">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d2e854" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2e854 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2e854 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2edc9" aria-expanded="false" aria-controls="trace-id-548f1e1d2edc9">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d2edc9" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2edc9 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2edc9 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2f49b" aria-expanded="false" aria-controls="trace-id-548f1e1d2f49b">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d2f49b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2f49b li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2f49b prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading1c95e7a3781a25adaa461232f4001d07-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#1c95e7a3781a25adaa461232f4001d07-call-548f1e1cf2f47" aria-expanded="false" aria-controls="1c95e7a3781a25adaa461232f4001d07-call-548f1e1cf2f47">
                                    Call #30 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="1c95e7a3781a25adaa461232f4001d07-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading1c95e7a3781a25adaa461232f4001d07-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading1c95e7a3781a25adaa461232f4001d07-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#1c95e7a3781a25adaa461232f4001d07-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="1c95e7a3781a25adaa461232f4001d07-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="1c95e7a3781a25adaa461232f4001d07-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading1c95e7a3781a25adaa461232f4001d07-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOItem.rdf#ItemsManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d2ffd5" aria-expanded="false" aria-controls="trace-id-548f1e1d2ffd5">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d2ffd5" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d2ffd5 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d2ffd5 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d305ef" aria-expanded="false" aria-controls="trace-id-548f1e1d305ef">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d305ef" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d305ef li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d305ef prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d30b5f" aria-expanded="false" aria-controls="trace-id-548f1e1d30b5f">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d30b5f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d30b5f li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d30b5f prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d31198" aria-expanded="false" aria-controls="trace-id-548f1e1d31198">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d31198" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d31198 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d31198 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading2ab0bce2acb3c4deda2c32aa6a781f19-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#2ab0bce2acb3c4deda2c32aa6a781f19-call-548f1e1cf2f47" aria-expanded="false" aria-controls="2ab0bce2acb3c4deda2c32aa6a781f19-call-548f1e1cf2f47">
                                    Call #31 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="2ab0bce2acb3c4deda2c32aa6a781f19-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading2ab0bce2acb3c4deda2c32aa6a781f19-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading2ab0bce2acb3c4deda2c32aa6a781f19-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#2ab0bce2acb3c4deda2c32aa6a781f19-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="2ab0bce2acb3c4deda2c32aa6a781f19-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="2ab0bce2acb3c4deda2c32aa6a781f19-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading2ab0bce2acb3c4deda2c32aa6a781f19-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOItem.rdf#QTIManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d31b81" aria-expanded="false" aria-controls="trace-id-548f1e1d31b81">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d31b81" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d31b81 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d31b81 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d31f97" aria-expanded="false" aria-controls="trace-id-548f1e1d31f97">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d31f97" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d31f97 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d31f97 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d326cb" aria-expanded="false" aria-controls="trace-id-548f1e1d326cb">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d326cb" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d326cb li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d326cb prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d32e74" aria-expanded="false" aria-controls="trace-id-548f1e1d32e74">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d32e74" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d32e74 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d32e74 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading17d404049713db8c5a8ff1e3a1c75b5d-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#17d404049713db8c5a8ff1e3a1c75b5d-call-548f1e1cf2f47" aria-expanded="false" aria-controls="17d404049713db8c5a8ff1e3a1c75b5d-call-548f1e1cf2f47">
                                    Call #32 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="17d404049713db8c5a8ff1e3a1c75b5d-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading17d404049713db8c5a8ff1e3a1c75b5d-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading17d404049713db8c5a8ff1e3a1c75b5d-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#17d404049713db8c5a8ff1e3a1c75b5d-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="17d404049713db8c5a8ff1e3a1c75b5d-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="17d404049713db8c5a8ff1e3a1c75b5d-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading17d404049713db8c5a8ff1e3a1c75b5d-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/generis.rdf#qtiItemPciManager
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d33b2e" aria-expanded="false" aria-controls="trace-id-548f1e1d33b2e">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d33b2e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d33b2e li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d33b2e prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d33faf" aria-expanded="false" aria-controls="trace-id-548f1e1d33faf">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d33faf" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d33faf li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d33faf prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d345a5" aria-expanded="false" aria-controls="trace-id-548f1e1d345a5">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d345a5" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d345a5 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d345a5 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d34c9e" aria-expanded="false" aria-controls="trace-id-548f1e1d34c9e">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d34c9e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d34c9e li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d34c9e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading025568153b905397d6f9a8789a7cb27d-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#025568153b905397d6f9a8789a7cb27d-call-548f1e1cf2f47" aria-expanded="false" aria-controls="025568153b905397d6f9a8789a7cb27d-call-548f1e1cf2f47">
                                    Call #33 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="025568153b905397d6f9a8789a7cb27d-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading025568153b905397d6f9a8789a7cb27d-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading025568153b905397d6f9a8789a7cb27d-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#025568153b905397d6f9a8789a7cb27d-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="025568153b905397d6f9a8789a7cb27d-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="025568153b905397d6f9a8789a7cb27d-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading025568153b905397d6f9a8789a7cb27d-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOItem.rdf#OWIManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d35833" aria-expanded="false" aria-controls="trace-id-548f1e1d35833">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d35833" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d35833 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d35833 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d35c67" aria-expanded="false" aria-controls="trace-id-548f1e1d35c67">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d35c67" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d35c67 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d35c67 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d364a0" aria-expanded="false" aria-controls="trace-id-548f1e1d364a0">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d364a0" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d364a0 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d364a0 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d36c0a" aria-expanded="false" aria-controls="trace-id-548f1e1d36c0a">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d36c0a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d36c0a li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d36c0a prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headinga2b9a54cf5e6241a83354a70573caade-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#a2b9a54cf5e6241a83354a70573caade-call-548f1e1cf2f47" aria-expanded="false" aria-controls="a2b9a54cf5e6241a83354a70573caade-call-548f1e1cf2f47">
                                    Call #34 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="a2b9a54cf5e6241a83354a70573caade-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headinga2b9a54cf5e6241a83354a70573caade-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headinga2b9a54cf5e6241a83354a70573caade-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#a2b9a54cf5e6241a83354a70573caade-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="a2b9a54cf5e6241a83354a70573caade-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="a2b9a54cf5e6241a83354a70573caade-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headinga2b9a54cf5e6241a83354a70573caade-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOTest.rdf#TestsManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d376a9" aria-expanded="false" aria-controls="trace-id-548f1e1d376a9">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d376a9" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d376a9 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d376a9 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d37b13" aria-expanded="false" aria-controls="trace-id-548f1e1d37b13">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d37b13" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d37b13 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d37b13 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d38121" aria-expanded="false" aria-controls="trace-id-548f1e1d38121">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d38121" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d38121 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d38121 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d387f6" aria-expanded="false" aria-controls="trace-id-548f1e1d387f6">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d387f6" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d387f6 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d387f6 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headinge3d69483fe16eab27ed677bde07ab5c0-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#e3d69483fe16eab27ed677bde07ab5c0-call-548f1e1cf2f47" aria-expanded="false" aria-controls="e3d69483fe16eab27ed677bde07ab5c0-call-548f1e1cf2f47">
                                    Call #35 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="e3d69483fe16eab27ed677bde07ab5c0-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headinge3d69483fe16eab27ed677bde07ab5c0-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headinge3d69483fe16eab27ed677bde07ab5c0-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#e3d69483fe16eab27ed677bde07ab5c0-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="e3d69483fe16eab27ed677bde07ab5c0-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="e3d69483fe16eab27ed677bde07ab5c0-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headinge3d69483fe16eab27ed677bde07ab5c0-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOTest.rdf#TaoQtiManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d39248" aria-expanded="false" aria-controls="trace-id-548f1e1d39248">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d39248" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d39248 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d39248 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d39641" aria-expanded="false" aria-controls="trace-id-548f1e1d39641">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d39641" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d39641 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d39641 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d39b87" aria-expanded="false" aria-controls="trace-id-548f1e1d39b87">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d39b87" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d39b87 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d39b87 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3a421" aria-expanded="false" aria-controls="trace-id-548f1e1d3a421">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d3a421" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3a421 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3a421 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading2d3b15434bd7c96ea08e0e73ae74caa6-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#2d3b15434bd7c96ea08e0e73ae74caa6-call-548f1e1cf2f47" aria-expanded="false" aria-controls="2d3b15434bd7c96ea08e0e73ae74caa6-call-548f1e1cf2f47">
                                    Call #36 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="2d3b15434bd7c96ea08e0e73ae74caa6-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading2d3b15434bd7c96ea08e0e73ae74caa6-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading2d3b15434bd7c96ea08e0e73ae74caa6-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#2d3b15434bd7c96ea08e0e73ae74caa6-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="2d3b15434bd7c96ea08e0e73ae74caa6-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="2d3b15434bd7c96ea08e0e73ae74caa6-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading2d3b15434bd7c96ea08e0e73ae74caa6-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/middleware/wfEngine.rdf#WorkflowsManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3aec3" aria-expanded="false" aria-controls="trace-id-548f1e1d3aec3">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d3aec3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3aec3 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3aec3 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3b33b" aria-expanded="false" aria-controls="trace-id-548f1e1d3b33b">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d3b33b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3b33b li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3b33b prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3b8eb" aria-expanded="false" aria-controls="trace-id-548f1e1d3b8eb">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d3b8eb" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3b8eb li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3b8eb prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3bf64" aria-expanded="false" aria-controls="trace-id-548f1e1d3bf64">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d3bf64" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3bf64 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3bf64 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading6ff8f3d751b2667baf2008f245a44a56-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#6ff8f3d751b2667baf2008f245a44a56-call-548f1e1cf2f47" aria-expanded="false" aria-controls="6ff8f3d751b2667baf2008f245a44a56-call-548f1e1cf2f47">
                                    Call #37 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="6ff8f3d751b2667baf2008f245a44a56-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading6ff8f3d751b2667baf2008f245a44a56-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading6ff8f3d751b2667baf2008f245a44a56-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#6ff8f3d751b2667baf2008f245a44a56-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="6ff8f3d751b2667baf2008f245a44a56-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="6ff8f3d751b2667baf2008f245a44a56-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading6ff8f3d751b2667baf2008f245a44a56-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOSubject.rdf#SubjectsManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3c970" aria-expanded="false" aria-controls="trace-id-548f1e1d3c970">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d3c970" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3c970 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3c970 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3cd5e" aria-expanded="false" aria-controls="trace-id-548f1e1d3cd5e">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d3cd5e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3cd5e li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3cd5e prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3d2e0" aria-expanded="false" aria-controls="trace-id-548f1e1d3d2e0">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d3d2e0" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3d2e0 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3d2e0 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3d985" aria-expanded="false" aria-controls="trace-id-548f1e1d3d985">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d3d985" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3d985 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3d985 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading237c49e3d2e4156b746b8cd8729ee879-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#237c49e3d2e4156b746b8cd8729ee879-call-548f1e1cf2f47" aria-expanded="false" aria-controls="237c49e3d2e4156b746b8cd8729ee879-call-548f1e1cf2f47">
                                    Call #38 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="237c49e3d2e4156b746b8cd8729ee879-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading237c49e3d2e4156b746b8cd8729ee879-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading237c49e3d2e4156b746b8cd8729ee879-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#237c49e3d2e4156b746b8cd8729ee879-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="237c49e3d2e4156b746b8cd8729ee879-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="237c49e3d2e4156b746b8cd8729ee879-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading237c49e3d2e4156b746b8cd8729ee879-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOGroup.rdf#GroupsManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3e3d3" aria-expanded="false" aria-controls="trace-id-548f1e1d3e3d3">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d3e3d3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3e3d3 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3e3d3 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3ea4a" aria-expanded="false" aria-controls="trace-id-548f1e1d3ea4a">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d3ea4a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3ea4a li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3ea4a prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3f096" aria-expanded="false" aria-controls="trace-id-548f1e1d3f096">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d3f096" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3f096 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3f096 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d3f79b" aria-expanded="false" aria-controls="trace-id-548f1e1d3f79b">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d3f79b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d3f79b li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d3f79b prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading348e71674d151aa08e354472144adddf-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#348e71674d151aa08e354472144adddf-call-548f1e1cf2f47" aria-expanded="false" aria-controls="348e71674d151aa08e354472144adddf-call-548f1e1cf2f47">
                                    Call #39 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="348e71674d151aa08e354472144adddf-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading348e71674d151aa08e354472144adddf-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading348e71674d151aa08e354472144adddf-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#348e71674d151aa08e354472144adddf-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="348e71674d151aa08e354472144adddf-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="348e71674d151aa08e354472144adddf-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading348e71674d151aa08e354472144adddf-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOResultServer.rdf#ResultServerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d40217" aria-expanded="false" aria-controls="trace-id-548f1e1d40217">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d40217" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d40217 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d40217 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d405e5" aria-expanded="false" aria-controls="trace-id-548f1e1d405e5">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d405e5" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d405e5 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d405e5 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d40bbe" aria-expanded="false" aria-controls="trace-id-548f1e1d40bbe">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d40bbe" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d40bbe li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d40bbe prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d41257" aria-expanded="false" aria-controls="trace-id-548f1e1d41257">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d41257" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d41257 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d41257 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingdcedcbbb9469abe450c13130a8bf74d1-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#dcedcbbb9469abe450c13130a8bf74d1-call-548f1e1cf2f47" aria-expanded="false" aria-controls="dcedcbbb9469abe450c13130a8bf74d1-call-548f1e1cf2f47">
                                    Call #40 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="dcedcbbb9469abe450c13130a8bf74d1-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingdcedcbbb9469abe450c13130a8bf74d1-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingdcedcbbb9469abe450c13130a8bf74d1-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#dcedcbbb9469abe450c13130a8bf74d1-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="dcedcbbb9469abe450c13130a8bf74d1-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="dcedcbbb9469abe450c13130a8bf74d1-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingdcedcbbb9469abe450c13130a8bf74d1-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/generis.rdf#taoOutcomeResultsManager
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d41c74" aria-expanded="false" aria-controls="trace-id-548f1e1d41c74">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d41c74" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d41c74 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d41c74 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d420ea" aria-expanded="false" aria-controls="trace-id-548f1e1d420ea">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d420ea" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d420ea li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d420ea prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4267e" aria-expanded="false" aria-controls="trace-id-548f1e1d4267e">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d4267e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4267e li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4267e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d42d93" aria-expanded="false" aria-controls="trace-id-548f1e1d42d93">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d42d93" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d42d93 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d42d93 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading8b6630767571ff5be3335dc27d058c66-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#8b6630767571ff5be3335dc27d058c66-call-548f1e1cf2f47" aria-expanded="false" aria-controls="8b6630767571ff5be3335dc27d058c66-call-548f1e1cf2f47">
                                    Call #41 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="8b6630767571ff5be3335dc27d058c66-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading8b6630767571ff5be3335dc27d058c66-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading8b6630767571ff5be3335dc27d058c66-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#8b6630767571ff5be3335dc27d058c66-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="8b6630767571ff5be3335dc27d058c66-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="8b6630767571ff5be3335dc27d058c66-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading8b6630767571ff5be3335dc27d058c66-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOTest.rdf#WfTestManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d43986" aria-expanded="false" aria-controls="trace-id-548f1e1d43986">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d43986" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d43986 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d43986 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d43d8e" aria-expanded="false" aria-controls="trace-id-548f1e1d43d8e">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d43d8e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d43d8e li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d43d8e prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4436c" aria-expanded="false" aria-controls="trace-id-548f1e1d4436c">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d4436c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4436c li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4436c prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d44ad0" aria-expanded="false" aria-controls="trace-id-548f1e1d44ad0">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d44ad0" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d44ad0 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d44ad0 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading7be247f5d007c77bde1214b28574f61d-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#7be247f5d007c77bde1214b28574f61d-call-548f1e1cf2f47" aria-expanded="false" aria-controls="7be247f5d007c77bde1214b28574f61d-call-548f1e1cf2f47">
                                    Call #42 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="7be247f5d007c77bde1214b28574f61d-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading7be247f5d007c77bde1214b28574f61d-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading7be247f5d007c77bde1214b28574f61d-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#7be247f5d007c77bde1214b28574f61d-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="7be247f5d007c77bde1214b28574f61d-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="7be247f5d007c77bde1214b28574f61d-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading7be247f5d007c77bde1214b28574f61d-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d454db" aria-expanded="false" aria-controls="trace-id-548f1e1d454db">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d454db" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d454db li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d454db prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d458d3" aria-expanded="false" aria-controls="trace-id-548f1e1d458d3">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d458d3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d458d3 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d458d3 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d45e47" aria-expanded="false" aria-controls="trace-id-548f1e1d45e47">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d45e47" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d45e47 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d45e47 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d46460" aria-expanded="false" aria-controls="trace-id-548f1e1d46460">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d46460" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d46460 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d46460 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading3940939c9b632d9aea251a9171e7e179-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#3940939c9b632d9aea251a9171e7e179-call-548f1e1cf2f47" aria-expanded="false" aria-controls="3940939c9b632d9aea251a9171e7e179-call-548f1e1cf2f47">
                                    Call #43 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="3940939c9b632d9aea251a9171e7e179-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading3940939c9b632d9aea251a9171e7e179-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading3940939c9b632d9aea251a9171e7e179-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#3940939c9b632d9aea251a9171e7e179-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="3940939c9b632d9aea251a9171e7e179-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="3940939c9b632d9aea251a9171e7e179-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading3940939c9b632d9aea251a9171e7e179-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOResult.rdf#ResultsManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d46ecb" aria-expanded="false" aria-controls="trace-id-548f1e1d46ecb">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d46ecb" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d46ecb li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d46ecb prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d47316" aria-expanded="false" aria-controls="trace-id-548f1e1d47316">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d47316" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d47316 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d47316 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d478e3" aria-expanded="false" aria-controls="trace-id-548f1e1d478e3">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d478e3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d478e3 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d478e3 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d48078" aria-expanded="false" aria-controls="trace-id-548f1e1d48078">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d48078" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d48078 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d48078 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading7bbcd9b4a13b309061d50902c5aa5f2e-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#7bbcd9b4a13b309061d50902c5aa5f2e-call-548f1e1cf2f47" aria-expanded="false" aria-controls="7bbcd9b4a13b309061d50902c5aa5f2e-call-548f1e1cf2f47">
                                    Call #44 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="7bbcd9b4a13b309061d50902c5aa5f2e-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading7bbcd9b4a13b309061d50902c5aa5f2e-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading7bbcd9b4a13b309061d50902c5aa5f2e-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#7bbcd9b4a13b309061d50902c5aa5f2e-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="7bbcd9b4a13b309061d50902c5aa5f2e-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="7bbcd9b4a13b309061d50902c5aa5f2e-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading7bbcd9b4a13b309061d50902c5aa5f2e-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAODelivery.rdf#taoSimpleDeliveryManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d48ae4" aria-expanded="false" aria-controls="trace-id-548f1e1d48ae4">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d48ae4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d48ae4 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d48ae4 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d48e99" aria-expanded="false" aria-controls="trace-id-548f1e1d48e99">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d48e99" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d48e99 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d48e99 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d493d6" aria-expanded="false" aria-controls="trace-id-548f1e1d493d6">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d493d6" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d493d6 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d493d6 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d49a9c" aria-expanded="false" aria-controls="trace-id-548f1e1d49a9c">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d49a9c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d49a9c li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d49a9c prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading96bc889c46bb772574604e9c923e5830-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#96bc889c46bb772574604e9c923e5830-call-548f1e1cf2f47" aria-expanded="false" aria-controls="96bc889c46bb772574604e9c923e5830-call-548f1e1cf2f47">
                                    Call #45 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="96bc889c46bb772574604e9c923e5830-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading96bc889c46bb772574604e9c923e5830-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading96bc889c46bb772574604e9c923e5830-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#96bc889c46bb772574604e9c923e5830-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="96bc889c46bb772574604e9c923e5830-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="96bc889c46bb772574604e9c923e5830-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading96bc889c46bb772574604e9c923e5830-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/generis.rdf#taoCeManager
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4a4d8" aria-expanded="false" aria-controls="trace-id-548f1e1d4a4d8">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d4a4d8" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4a4d8 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4a4d8 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4ae0c" aria-expanded="false" aria-controls="trace-id-548f1e1d4ae0c">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d4ae0c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4ae0c li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4ae0c prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4b490" aria-expanded="false" aria-controls="trace-id-548f1e1d4b490">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d4b490" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4b490 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4b490 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4bb35" aria-expanded="false" aria-controls="trace-id-548f1e1d4bb35">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d4bb35" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4bb35 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4bb35 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading42af383811a110c962539e1fbc5bff97-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#42af383811a110c962539e1fbc5bff97-call-548f1e1cf2f47" aria-expanded="false" aria-controls="42af383811a110c962539e1fbc5bff97-call-548f1e1cf2f47">
                                    Call #46 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="42af383811a110c962539e1fbc5bff97-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading42af383811a110c962539e1fbc5bff97-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading42af383811a110c962539e1fbc5bff97-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#42af383811a110c962539e1fbc5bff97-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="42af383811a110c962539e1fbc5bff97-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="42af383811a110c962539e1fbc5bff97-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading42af383811a110c962539e1fbc5bff97-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#SysAdminRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4c591" aria-expanded="false" aria-controls="trace-id-548f1e1d4c591">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d4c591" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4c591 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4c591 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4c9d7" aria-expanded="false" aria-controls="trace-id-548f1e1d4c9d7">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d4c9d7" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4c9d7 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4c9d7 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4cf64" aria-expanded="false" aria-controls="trace-id-548f1e1d4cf64">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d4cf64" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4cf64 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4cf64 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4d672" aria-expanded="false" aria-controls="trace-id-548f1e1d4d672">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d4d672" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4d672 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4d672 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading012f0b4de47a003fda59cfc46150f456-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#012f0b4de47a003fda59cfc46150f456-call-548f1e1cf2f47" aria-expanded="false" aria-controls="012f0b4de47a003fda59cfc46150f456-call-548f1e1cf2f47">
                                    Call #47 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="012f0b4de47a003fda59cfc46150f456-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading012f0b4de47a003fda59cfc46150f456-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading012f0b4de47a003fda59cfc46150f456-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#012f0b4de47a003fda59cfc46150f456-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="012f0b4de47a003fda59cfc46150f456-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="012f0b4de47a003fda59cfc46150f456-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading012f0b4de47a003fda59cfc46150f456-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/generis.rdf#taoDacSimpleManager
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4e20a" aria-expanded="false" aria-controls="trace-id-548f1e1d4e20a">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d4e20a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4e20a li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4e20a prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4e6fd" aria-expanded="false" aria-controls="trace-id-548f1e1d4e6fd">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d4e6fd" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4e6fd li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4e6fd prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4ed05" aria-expanded="false" aria-controls="trace-id-548f1e1d4ed05">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d4ed05" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4ed05 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4ed05 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4f414" aria-expanded="false" aria-controls="trace-id-548f1e1d4f414">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d4f414" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4f414 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4f414 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingcf1c5ad3843280ddf1c70090225fffef-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#cf1c5ad3843280ddf1c70090225fffef-call-548f1e1cf2f47" aria-expanded="false" aria-controls="cf1c5ad3843280ddf1c70090225fffef-call-548f1e1cf2f47">
                                    Call #48 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="cf1c5ad3843280ddf1c70090225fffef-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingcf1c5ad3843280ddf1c70090225fffef-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingcf1c5ad3843280ddf1c70090225fffef-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#cf1c5ad3843280ddf1c70090225fffef-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="cf1c5ad3843280ddf1c70090225fffef-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="cf1c5ad3843280ddf1c70090225fffef-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingcf1c5ad3843280ddf1c70090225fffef-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#DeliveryRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d4fec9" aria-expanded="false" aria-controls="trace-id-548f1e1d4fec9">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d4fec9" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d4fec9 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d4fec9 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d501a2" aria-expanded="false" aria-controls="trace-id-548f1e1d501a2">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d501a2" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d501a2 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d501a2 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d50771" aria-expanded="false" aria-controls="trace-id-548f1e1d50771">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d50771" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d50771 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d50771 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d50dec" aria-expanded="false" aria-controls="trace-id-548f1e1d50dec">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d50dec" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d50dec li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d50dec prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingfbfafb110acbf6f39bc45fcc921cc820-call-548f1e1cf2f47">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1cf2f47" href="#fbfafb110acbf6f39bc45fcc921cc820-call-548f1e1cf2f47" aria-expanded="false" aria-controls="fbfafb110acbf6f39bc45fcc921cc820-call-548f1e1cf2f47">
                                    Call #49 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="fbfafb110acbf6f39bc45fcc921cc820-call-548f1e1cf2f47" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingfbfafb110acbf6f39bc45fcc921cc820-call-548f1e1cf2f47">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1cf2f47" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingfbfafb110acbf6f39bc45fcc921cc820-trace-548f1e1cf2f47">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1cf2f47" href="#fbfafb110acbf6f39bc45fcc921cc820-trace-548f1e1cf2f47" aria-expanded="true" aria-controls="fbfafb110acbf6f39bc45fcc921cc820-trace-548f1e1cf2f47">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="fbfafb110acbf6f39bc45fcc921cc820-trace-548f1e1cf2f47" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingfbfafb110acbf6f39bc45fcc921cc820-trace-548f1e1cf2f47">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#WorkflowRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d517d6" aria-expanded="false" aria-controls="trace-id-548f1e1d517d6">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d517d6" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d517d6 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d517d6 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d51bf2" aria-expanded="false" aria-controls="trace-id-548f1e1d51bf2">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d51bf2" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d51bf2 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d51bf2 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d522d9" aria-expanded="false" aria-controls="trace-id-548f1e1d522d9">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d522d9" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d522d9 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d522d9 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d52a4e" aria-expanded="false" aria-controls="trace-id-548f1e1d52a4e">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d52a4e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d52a4e li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d52a4e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                                    </div>
                            </div>
        </div>
        </div>
</div>
                            </div>
                            <div role="tabpanel" class="tab-pane" id="methods">
                                
            <div class="panel panel-danger">
            <div class="panel-heading">
                <h3 class="panel-title">Method : core_kernel_classes_DbWrapper::query : 192/118 (61.46%)</h3>
            </div>
            <div class="panel-body">

                                <div class="panel-group" id="accordion-method-548f1e1d5357b" role="tablist" aria-multiselectable="true">

                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading17404f4056752363312989c79113dfd6-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#17404f4056752363312989c79113dfd6-call-548f1e1d5357b" aria-expanded="false" aria-controls="17404f4056752363312989c79113dfd6-call-548f1e1d5357b">
                                    Call #1 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="17404f4056752363312989c79113dfd6-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading17404f4056752363312989c79113dfd6-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading17404f4056752363312989c79113dfd6-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#17404f4056752363312989c79113dfd6-trace-548f1e1d5357b" aria-expanded="true" aria-controls="17404f4056752363312989c79113dfd6-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="17404f4056752363312989c79113dfd6-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading17404f4056752363312989c79113dfd6-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object FROM statements WHERE subject = ?  AND predicate = ?
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#User
            [1] => http://www.w3.org/2000/01/rdf-schema#subClassOf
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(tao/actions/form\rclass.Instance.php::99\rgetClassProperties)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::187\rgetParentClasses)-1>(generis/core/kernel/classes\rclass.Class.php::95\rgetParentClasses),(tao/actions/form\rclass.Instance.php::99\rgetClassProperties)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::169\rgetParentClasses)-1>(generis/core/kernel/classes\rclass.Class.php::95\rgetParentClasses)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (108)]</li>
                <li>&nbsp;&nbsp; => getParentClasses [/var/www/generis/core/kernel/classes/class.Class.php (95)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d538da" aria-expanded="false" aria-controls="trace-id-548f1e1d538da">
                        getParentClasses [/var/www/tao/helpers/form/class.GenerisFormFactory.php (187)]
                    </a>
                                        <div id="trace-id-548f1e1d538da" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d538da li:nth-child(46 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d538da prettyprint linenums:142 linenums">    public static function getClassProperties( core_kernel_classes_Class $clazz,  core_kernel_classes_Class $topLevelClazz = null)
    {
        $returnValue = array();

        
		
		 
        if(is_null($topLevelClazz)){
			$topLevelClazz = new core_kernel_classes_Class(TAO_OBJECT_CLASS);
		}
		
		
		if($clazz->getUri() == $topLevelClazz->getUri()){
			$returnValue = $clazz->getProperties(false);
			return (array) $returnValue;
		}
		
		//determine the parent path
		$parents = array();
		$top = false;
		do{
			if(!isset($lastLevelParents)){
				$parentClasses = $clazz->getParentClasses(false);
			}
			else{
				$parentClasses = array();
				foreach($lastLevelParents as $parent){
					$parentClasses = array_merge($parentClasses, $parent->getParentClasses(false));
				}
			}
			if(count($parentClasses) == 0){
				break;
			}
			$lastLevelParents = array();
			foreach($parentClasses as $parentClass){
				if($parentClass->getUri() == RDFS_CLASS){
					continue;
				}
				if($parentClass->getUri() == $topLevelClazz->getUri() ) {
					$parents[$parentClass->getUri()] = $parentClass;	
					$top = true;
					break;
				}
				
				
				$allParentClasses = $parentClass->getParentClasses(true);
				if(array_key_exists($topLevelClazz->getUri(), $allParentClasses)){
					 $parents[$parentClass->getUri()] = $parentClass;
				}
				
				$lastLevelParents[$parentClass->getUri()] = $parentClass;
			}
		}while(!$top);
		
		foreach($parents as $parent){
			$returnValue = array_merge($returnValue, $parent->getProperties(false));
    	}
    	$returnValue = array_merge($returnValue, $clazz->getProperties(false));
		
        

        return (array) $returnValue;
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d53eba" aria-expanded="false" aria-controls="trace-id-548f1e1d53eba">
                        getParentClasses [/var/www/tao/helpers/form/class.GenerisFormFactory.php (169)]
                    </a>
                                        <div id="trace-id-548f1e1d53eba" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d53eba li:nth-child(28 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d53eba prettyprint linenums:142 linenums">    public static function getClassProperties( core_kernel_classes_Class $clazz,  core_kernel_classes_Class $topLevelClazz = null)
    {
        $returnValue = array();

        
		
		 
        if(is_null($topLevelClazz)){
			$topLevelClazz = new core_kernel_classes_Class(TAO_OBJECT_CLASS);
		}
		
		
		if($clazz->getUri() == $topLevelClazz->getUri()){
			$returnValue = $clazz->getProperties(false);
			return (array) $returnValue;
		}
		
		//determine the parent path
		$parents = array();
		$top = false;
		do{
			if(!isset($lastLevelParents)){
				$parentClasses = $clazz->getParentClasses(false);
			}
			else{
				$parentClasses = array();
				foreach($lastLevelParents as $parent){
					$parentClasses = array_merge($parentClasses, $parent->getParentClasses(false));
				}
			}
			if(count($parentClasses) == 0){
				break;
			}
			$lastLevelParents = array();
			foreach($parentClasses as $parentClass){
				if($parentClass->getUri() == RDFS_CLASS){
					continue;
				}
				if($parentClass->getUri() == $topLevelClazz->getUri() ) {
					$parents[$parentClass->getUri()] = $parentClass;	
					$top = true;
					break;
				}
				
				
				$allParentClasses = $parentClass->getParentClasses(true);
				if(array_key_exists($topLevelClazz->getUri(), $allParentClasses)){
					 $parents[$parentClass->getUri()] = $parentClass;
				}
				
				$lastLevelParents[$parentClass->getUri()] = $parentClass;
			}
		}while(!$top);
		
		foreach($parents as $parent){
			$returnValue = array_merge($returnValue, $parent->getProperties(false));
    	}
    	$returnValue = array_merge($returnValue, $clazz->getProperties(false));
		
        

        return (array) $returnValue;
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => getClassProperties [/var/www/tao/actions/form/class.Instance.php (99)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/actions/form/class.Users.php (160)]</li>
                <li>&nbsp;&nbsp;&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading35f95d9da9dc35f8f091277d5987dcac-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#35f95d9da9dc35f8f091277d5987dcac-call-548f1e1d5357b" aria-expanded="false" aria-controls="35f95d9da9dc35f8f091277d5987dcac-call-548f1e1d5357b">
                                    Call #2 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="35f95d9da9dc35f8f091277d5987dcac-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading35f95d9da9dc35f8f091277d5987dcac-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading35f95d9da9dc35f8f091277d5987dcac-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#35f95d9da9dc35f8f091277d5987dcac-trace-548f1e1d5357b" aria-expanded="true" aria-controls="35f95d9da9dc35f8f091277d5987dcac-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="35f95d9da9dc35f8f091277d5987dcac-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading35f95d9da9dc35f8f091277d5987dcac-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT subject FROM statements WHERE predicate = ? and object  = ?
    [1] => Array
        (
            [0] => http://www.w3.org/2000/01/rdf-schema#subClassOf
            [1] => http://www.tao.lu/Ontologies/TAO.rdf#Languages
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(generis/core/kernel/persistence/smoothsql\rclass.Class.php::48\rquery)-2>(taoTestTaker\rindex.php::0\r{main})">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (48)]</li>
                <li>&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (508)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getFilteredQuery [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (172)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => elementMap [/var/www/tao/actions/form/class.Instance.php (128)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/tao/actions/form/class.Users.php (160)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 2</span>
        <ul>
        This trace is completely contained in starting and ending parts.        </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingde480c2280ecf632fe3a9b1bdd0f03c5-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#de480c2280ecf632fe3a9b1bdd0f03c5-call-548f1e1d5357b" aria-expanded="false" aria-controls="de480c2280ecf632fe3a9b1bdd0f03c5-call-548f1e1d5357b">
                                    Call #3 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="de480c2280ecf632fe3a9b1bdd0f03c5-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingde480c2280ecf632fe3a9b1bdd0f03c5-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingde480c2280ecf632fe3a9b1bdd0f03c5-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#de480c2280ecf632fe3a9b1bdd0f03c5-trace-548f1e1d5357b" aria-expanded="true" aria-controls="de480c2280ecf632fe3a9b1bdd0f03c5-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="de480c2280ecf632fe3a9b1bdd0f03c5-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingde480c2280ecf632fe3a9b1bdd0f03c5-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT DISTINCT subject FROM statements WHERE (predicate = 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type') AND (object = 'http://www.tao.lu/Ontologies/TAO.rdf#Languages')
)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(generis/core/kernel/persistence/smoothsql\rclass.Class.php::173\rquery)-2>(taoTestTaker\rindex.php::0\r{main})">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (173)]</li>
                <li>&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => elementMap [/var/www/tao/actions/form/class.Instance.php (128)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/tao/actions/form/class.Users.php (160)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 2</span>
        <ul>
        This trace is completely contained in starting and ending parts.        </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headinga5ab419a811020a9dc88839e86e5af2e-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#a5ab419a811020a9dc88839e86e5af2e-call-548f1e1d5357b" aria-expanded="false" aria-controls="a5ab419a811020a9dc88839e86e5af2e-call-548f1e1d5357b">
                                    Call #4 (6 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="a5ab419a811020a9dc88839e86e5af2e-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headinga5ab419a811020a9dc88839e86e5af2e-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headinga5ab419a811020a9dc88839e86e5af2e-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#a5ab419a811020a9dc88839e86e5af2e-trace-548f1e1d5357b" aria-expanded="true" aria-controls="a5ab419a811020a9dc88839e86e5af2e-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="a5ab419a811020a9dc88839e86e5af2e-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headinga5ab419a811020a9dc88839e86e5af2e-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#Langda-DK
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-4>(tao/actions/form\rclass.Users.php::160\rinitElements)-4>(tao/actions/form\rclass.Instance.php::128\relementMap)-4>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-4>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::189\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::199\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 4</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d54a4f" aria-expanded="false" aria-controls="trace-id-548f1e1d54a4f">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d54a4f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d54a4f li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d54a4f prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d54e53" aria-expanded="false" aria-controls="trace-id-548f1e1d54e53">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d54e53" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d54e53 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d54e53 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d554a0" aria-expanded="false" aria-controls="trace-id-548f1e1d554a0">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d554a0" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d554a0 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d554a0 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d55b8c" aria-expanded="false" aria-controls="trace-id-548f1e1d55b8c">
                        getLabel [/var/www/tao/actions/form/class.Users.php (189)]
                    </a>
                                        <div id="trace-id-548f1e1d55b8c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d55b8c li:nth-child(38 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d55b8c prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d56289" aria-expanded="false" aria-controls="trace-id-548f1e1d56289">
                        getLabel [/var/www/tao/actions/form/class.Users.php (199)]
                    </a>
                                        <div id="trace-id-548f1e1d56289" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d56289 li:nth-child(48 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d56289 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingaf83c295edb9fffb06de799ac95181bb-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#af83c295edb9fffb06de799ac95181bb-call-548f1e1d5357b" aria-expanded="false" aria-controls="af83c295edb9fffb06de799ac95181bb-call-548f1e1d5357b">
                                    Call #5 (6 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="af83c295edb9fffb06de799ac95181bb-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingaf83c295edb9fffb06de799ac95181bb-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingaf83c295edb9fffb06de799ac95181bb-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#af83c295edb9fffb06de799ac95181bb-trace-548f1e1d5357b" aria-expanded="true" aria-controls="af83c295edb9fffb06de799ac95181bb-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="af83c295edb9fffb06de799ac95181bb-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingaf83c295edb9fffb06de799ac95181bb-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#Langen-US
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-4>(tao/actions/form\rclass.Users.php::160\rinitElements)-4>(tao/actions/form\rclass.Instance.php::128\relementMap)-4>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-4>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::189\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::199\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 4</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d56e7e" aria-expanded="false" aria-controls="trace-id-548f1e1d56e7e">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d56e7e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d56e7e li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d56e7e prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d572c7" aria-expanded="false" aria-controls="trace-id-548f1e1d572c7">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d572c7" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d572c7 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d572c7 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d578a3" aria-expanded="false" aria-controls="trace-id-548f1e1d578a3">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d578a3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d578a3 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d578a3 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d57fa0" aria-expanded="false" aria-controls="trace-id-548f1e1d57fa0">
                        getLabel [/var/www/tao/actions/form/class.Users.php (189)]
                    </a>
                                        <div id="trace-id-548f1e1d57fa0" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d57fa0 li:nth-child(38 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d57fa0 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d58657" aria-expanded="false" aria-controls="trace-id-548f1e1d58657">
                        getLabel [/var/www/tao/actions/form/class.Users.php (199)]
                    </a>
                                        <div id="trace-id-548f1e1d58657" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d58657 li:nth-child(48 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d58657 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingc83c9e7643542967fd7f15c4addb9b5d-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#c83c9e7643542967fd7f15c4addb9b5d-call-548f1e1d5357b" aria-expanded="false" aria-controls="c83c9e7643542967fd7f15c4addb9b5d-call-548f1e1d5357b">
                                    Call #6 (6 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="c83c9e7643542967fd7f15c4addb9b5d-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingc83c9e7643542967fd7f15c4addb9b5d-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingc83c9e7643542967fd7f15c4addb9b5d-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#c83c9e7643542967fd7f15c4addb9b5d-trace-548f1e1d5357b" aria-expanded="true" aria-controls="c83c9e7643542967fd7f15c4addb9b5d-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="c83c9e7643542967fd7f15c4addb9b5d-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingc83c9e7643542967fd7f15c4addb9b5d-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#Langfr-FR
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-4>(tao/actions/form\rclass.Users.php::160\rinitElements)-4>(tao/actions/form\rclass.Instance.php::128\relementMap)-4>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-4>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::189\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::199\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 4</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d592af" aria-expanded="false" aria-controls="trace-id-548f1e1d592af">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d592af" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d592af li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d592af prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d59702" aria-expanded="false" aria-controls="trace-id-548f1e1d59702">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d59702" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d59702 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d59702 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d59d6a" aria-expanded="false" aria-controls="trace-id-548f1e1d59d6a">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d59d6a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d59d6a li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d59d6a prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d5a4d0" aria-expanded="false" aria-controls="trace-id-548f1e1d5a4d0">
                        getLabel [/var/www/tao/actions/form/class.Users.php (189)]
                    </a>
                                        <div id="trace-id-548f1e1d5a4d0" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d5a4d0 li:nth-child(38 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d5a4d0 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d5ac88" aria-expanded="false" aria-controls="trace-id-548f1e1d5ac88">
                        getLabel [/var/www/tao/actions/form/class.Users.php (199)]
                    </a>
                                        <div id="trace-id-548f1e1d5ac88" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d5ac88 li:nth-child(48 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d5ac88 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingdfa5747b0d101d9f7d07bcf98a5d73c4-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#dfa5747b0d101d9f7d07bcf98a5d73c4-call-548f1e1d5357b" aria-expanded="false" aria-controls="dfa5747b0d101d9f7d07bcf98a5d73c4-call-548f1e1d5357b">
                                    Call #7 (6 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="dfa5747b0d101d9f7d07bcf98a5d73c4-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingdfa5747b0d101d9f7d07bcf98a5d73c4-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingdfa5747b0d101d9f7d07bcf98a5d73c4-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#dfa5747b0d101d9f7d07bcf98a5d73c4-trace-548f1e1d5357b" aria-expanded="true" aria-controls="dfa5747b0d101d9f7d07bcf98a5d73c4-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="dfa5747b0d101d9f7d07bcf98a5d73c4-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingdfa5747b0d101d9f7d07bcf98a5d73c4-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#Langpt-PT
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-4>(tao/actions/form\rclass.Users.php::160\rinitElements)-4>(tao/actions/form\rclass.Instance.php::128\relementMap)-4>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-4>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::189\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::199\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 4</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d5b8f1" aria-expanded="false" aria-controls="trace-id-548f1e1d5b8f1">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d5b8f1" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d5b8f1 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d5b8f1 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d5bf5b" aria-expanded="false" aria-controls="trace-id-548f1e1d5bf5b">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d5bf5b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d5bf5b li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d5bf5b prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d5c527" aria-expanded="false" aria-controls="trace-id-548f1e1d5c527">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d5c527" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d5c527 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d5c527 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d5cc2f" aria-expanded="false" aria-controls="trace-id-548f1e1d5cc2f">
                        getLabel [/var/www/tao/actions/form/class.Users.php (189)]
                    </a>
                                        <div id="trace-id-548f1e1d5cc2f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d5cc2f li:nth-child(38 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d5cc2f prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d5d330" aria-expanded="false" aria-controls="trace-id-548f1e1d5d330">
                        getLabel [/var/www/tao/actions/form/class.Users.php (199)]
                    </a>
                                        <div id="trace-id-548f1e1d5d330" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d5d330 li:nth-child(48 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d5d330 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading844c4c19b8853e8013283c4a49b73590-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#844c4c19b8853e8013283c4a49b73590-call-548f1e1d5357b" aria-expanded="false" aria-controls="844c4c19b8853e8013283c4a49b73590-call-548f1e1d5357b">
                                    Call #8 (6 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="844c4c19b8853e8013283c4a49b73590-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading844c4c19b8853e8013283c4a49b73590-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading844c4c19b8853e8013283c4a49b73590-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#844c4c19b8853e8013283c4a49b73590-trace-548f1e1d5357b" aria-expanded="true" aria-controls="844c4c19b8853e8013283c4a49b73590-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="844c4c19b8853e8013283c4a49b73590-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading844c4c19b8853e8013283c4a49b73590-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#Langsv-SE
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-4>(tao/actions/form\rclass.Users.php::160\rinitElements)-4>(tao/actions/form\rclass.Instance.php::128\relementMap)-4>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-4>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::189\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::199\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 4</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d5e0f3" aria-expanded="false" aria-controls="trace-id-548f1e1d5e0f3">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d5e0f3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d5e0f3 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d5e0f3 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d5e68c" aria-expanded="false" aria-controls="trace-id-548f1e1d5e68c">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d5e68c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d5e68c li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d5e68c prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d5ec15" aria-expanded="false" aria-controls="trace-id-548f1e1d5ec15">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d5ec15" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d5ec15 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d5ec15 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d5f3b5" aria-expanded="false" aria-controls="trace-id-548f1e1d5f3b5">
                        getLabel [/var/www/tao/actions/form/class.Users.php (189)]
                    </a>
                                        <div id="trace-id-548f1e1d5f3b5" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d5f3b5 li:nth-child(38 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d5f3b5 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d5fa82" aria-expanded="false" aria-controls="trace-id-548f1e1d5fa82">
                        getLabel [/var/www/tao/actions/form/class.Users.php (199)]
                    </a>
                                        <div id="trace-id-548f1e1d5fa82" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d5fa82 li:nth-child(48 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d5fa82 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading64469fb082b0b741efcae70afc7fc6ff-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#64469fb082b0b741efcae70afc7fc6ff-call-548f1e1d5357b" aria-expanded="false" aria-controls="64469fb082b0b741efcae70afc7fc6ff-call-548f1e1d5357b">
                                    Call #9 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="64469fb082b0b741efcae70afc7fc6ff-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading64469fb082b0b741efcae70afc7fc6ff-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading64469fb082b0b741efcae70afc7fc6ff-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#64469fb082b0b741efcae70afc7fc6ff-trace-548f1e1d5357b" aria-expanded="true" aria-controls="64469fb082b0b741efcae70afc7fc6ff-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="64469fb082b0b741efcae70afc7fc6ff-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading64469fb082b0b741efcae70afc7fc6ff-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT subject FROM statements WHERE predicate = ? and object  = ?
    [1] => Array
        (
            [0] => http://www.w3.org/2000/01/rdf-schema#subClassOf
            [1] => http://www.tao.lu/Ontologies/generis.rdf#ClassRole
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::110\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::206\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (48)]</li>
                <li>&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (508)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getFilteredQuery [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (172)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d604f1" aria-expanded="false" aria-controls="trace-id-548f1e1d604f1">
                        getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]
                    </a>
                                        <div id="trace-id-548f1e1d604f1" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d604f1 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d604f1 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d60902" aria-expanded="false" aria-controls="trace-id-548f1e1d60902">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d60902" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d60902 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d60902 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d60fd1" aria-expanded="false" aria-controls="trace-id-548f1e1d60fd1">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d60fd1" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d60fd1 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d60fd1 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d616f3" aria-expanded="false" aria-controls="trace-id-548f1e1d616f3">
                        getInstances [/var/www/tao/actions/form/class.Users.php (206)]
                    </a>
                                        <div id="trace-id-548f1e1d616f3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d616f3 li:nth-child(55 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d616f3 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading58c61738e419da9fa368e1ee27491cca-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#58c61738e419da9fa368e1ee27491cca-call-548f1e1d5357b" aria-expanded="false" aria-controls="58c61738e419da9fa368e1ee27491cca-call-548f1e1d5357b">
                                    Call #10 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="58c61738e419da9fa368e1ee27491cca-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading58c61738e419da9fa368e1ee27491cca-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading58c61738e419da9fa368e1ee27491cca-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#58c61738e419da9fa368e1ee27491cca-trace-548f1e1d5357b" aria-expanded="true" aria-controls="58c61738e419da9fa368e1ee27491cca-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="58c61738e419da9fa368e1ee27491cca-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading58c61738e419da9fa368e1ee27491cca-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT subject FROM statements WHERE predicate = ? and object  = ?
    [1] => Array
        (
            [0] => http://www.w3.org/2000/01/rdf-schema#subClassOf
            [1] => http://www.tao.lu/Ontologies/generis.rdf#AbstractRole
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::110\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::206\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (48)]</li>
                <li>&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/classes/class.Class.php (69)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (54)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (508)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getFilteredQuery [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (172)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d622a3" aria-expanded="false" aria-controls="trace-id-548f1e1d622a3">
                        getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]
                    </a>
                                        <div id="trace-id-548f1e1d622a3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d622a3 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d622a3 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d626c9" aria-expanded="false" aria-controls="trace-id-548f1e1d626c9">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d626c9" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d626c9 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d626c9 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d62cb9" aria-expanded="false" aria-controls="trace-id-548f1e1d62cb9">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d62cb9" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d62cb9 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d62cb9 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d633da" aria-expanded="false" aria-controls="trace-id-548f1e1d633da">
                        getInstances [/var/www/tao/actions/form/class.Users.php (206)]
                    </a>
                                        <div id="trace-id-548f1e1d633da" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d633da li:nth-child(55 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d633da prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingc977df3d4308e9361507c92c00a793cd-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#c977df3d4308e9361507c92c00a793cd-call-548f1e1d5357b" aria-expanded="false" aria-controls="c977df3d4308e9361507c92c00a793cd-call-548f1e1d5357b">
                                    Call #11 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="c977df3d4308e9361507c92c00a793cd-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingc977df3d4308e9361507c92c00a793cd-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingc977df3d4308e9361507c92c00a793cd-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#c977df3d4308e9361507c92c00a793cd-trace-548f1e1d5357b" aria-expanded="true" aria-controls="c977df3d4308e9361507c92c00a793cd-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="c977df3d4308e9361507c92c00a793cd-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingc977df3d4308e9361507c92c00a793cd-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT subject FROM statements WHERE predicate = ? and object  = ?
    [1] => Array
        (
            [0] => http://www.w3.org/2000/01/rdf-schema#subClassOf
            [1] => http://www.tao.lu/Ontologies/TAO.rdf#ManagementRole
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::110\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::206\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (48)]</li>
                <li>&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/classes/class.Class.php (69)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (54)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (508)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getFilteredQuery [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (172)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d63e2a" aria-expanded="false" aria-controls="trace-id-548f1e1d63e2a">
                        getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]
                    </a>
                                        <div id="trace-id-548f1e1d63e2a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d63e2a li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d63e2a prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d641cb" aria-expanded="false" aria-controls="trace-id-548f1e1d641cb">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d641cb" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d641cb li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d641cb prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d64744" aria-expanded="false" aria-controls="trace-id-548f1e1d64744">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d64744" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d64744 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d64744 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d64e7e" aria-expanded="false" aria-controls="trace-id-548f1e1d64e7e">
                        getInstances [/var/www/tao/actions/form/class.Users.php (206)]
                    </a>
                                        <div id="trace-id-548f1e1d64e7e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d64e7e li:nth-child(55 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d64e7e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingb8642f18978944d459791e01fce4ca21-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#b8642f18978944d459791e01fce4ca21-call-548f1e1d5357b" aria-expanded="false" aria-controls="b8642f18978944d459791e01fce4ca21-call-548f1e1d5357b">
                                    Call #12 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="b8642f18978944d459791e01fce4ca21-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingb8642f18978944d459791e01fce4ca21-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingb8642f18978944d459791e01fce4ca21-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#b8642f18978944d459791e01fce4ca21-trace-548f1e1d5357b" aria-expanded="true" aria-controls="b8642f18978944d459791e01fce4ca21-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="b8642f18978944d459791e01fce4ca21-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingb8642f18978944d459791e01fce4ca21-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT subject FROM statements WHERE predicate = ? and object  = ?
    [1] => Array
        (
            [0] => http://www.w3.org/2000/01/rdf-schema#subClassOf
            [1] => http://www.tao.lu/Ontologies/TAO.rdf#WorkerRole
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::110\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::206\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (48)]</li>
                <li>&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/classes/class.Class.php (69)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (54)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getSubClasses [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (508)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getFilteredQuery [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (172)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d65987" aria-expanded="false" aria-controls="trace-id-548f1e1d65987">
                        getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]
                    </a>
                                        <div id="trace-id-548f1e1d65987" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d65987 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d65987 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d65e12" aria-expanded="false" aria-controls="trace-id-548f1e1d65e12">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d65e12" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d65e12 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d65e12 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d663d0" aria-expanded="false" aria-controls="trace-id-548f1e1d663d0">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d663d0" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d663d0 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d663d0 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d66af1" aria-expanded="false" aria-controls="trace-id-548f1e1d66af1">
                        getInstances [/var/www/tao/actions/form/class.Users.php (206)]
                    </a>
                                        <div id="trace-id-548f1e1d66af1" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d66af1 li:nth-child(55 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d66af1 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading5b7043ebeb16efc4b7139fe4b1a6912c-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#5b7043ebeb16efc4b7139fe4b1a6912c-call-548f1e1d5357b" aria-expanded="false" aria-controls="5b7043ebeb16efc4b7139fe4b1a6912c-call-548f1e1d5357b">
                                    Call #13 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="5b7043ebeb16efc4b7139fe4b1a6912c-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading5b7043ebeb16efc4b7139fe4b1a6912c-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading5b7043ebeb16efc4b7139fe4b1a6912c-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#5b7043ebeb16efc4b7139fe4b1a6912c-trace-548f1e1d5357b" aria-expanded="true" aria-controls="5b7043ebeb16efc4b7139fe4b1a6912c-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="5b7043ebeb16efc4b7139fe4b1a6912c-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading5b7043ebeb16efc4b7139fe4b1a6912c-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT DISTINCT subject FROM statements WHERE (predicate = 'http://www.w3.org/1999/02/22-rdf-syntax-ns#type') AND (object = 'http://www.tao.lu/Ontologies/generis.rdf#AbstractRole' OR object = 'http://www.tao.lu/Ontologies/TAO.rdf#ManagementRole' OR object = 'http://www.tao.lu/Ontologies/TAO.rdf#WorkerRole' OR object = 'http://www.tao.lu/Ontologies/generis.rdf#ClassRole')
)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::110\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::206\rgetInstances)-1>(generis/core/kernel/classes\rclass.Class.php::124\rgetInstances)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Class.php (173)]</li>
                <li>&nbsp;&nbsp; => getInstances [/var/www/generis/core/kernel/classes/class.Class.php (124)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d67593" aria-expanded="false" aria-controls="trace-id-548f1e1d67593">
                        getInstances [/var/www/tao/helpers/form/class.GenerisFormFactory.php (110)]
                    </a>
                                        <div id="trace-id-548f1e1d67593" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d67593 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d67593 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d679b4" aria-expanded="false" aria-controls="trace-id-548f1e1d679b4">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d679b4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d679b4 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d679b4 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d67eed" aria-expanded="false" aria-controls="trace-id-548f1e1d67eed">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d67eed" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d67eed li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d67eed prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6862f" aria-expanded="false" aria-controls="trace-id-548f1e1d6862f">
                        getInstances [/var/www/tao/actions/form/class.Users.php (206)]
                    </a>
                                        <div id="trace-id-548f1e1d6862f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6862f li:nth-child(55 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6862f prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading2dc54e97ecbc631ec3098645dce2bf05-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#2dc54e97ecbc631ec3098645dce2bf05-call-548f1e1d5357b" aria-expanded="false" aria-controls="2dc54e97ecbc631ec3098645dce2bf05-call-548f1e1d5357b">
                                    Call #14 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="2dc54e97ecbc631ec3098645dce2bf05-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading2dc54e97ecbc631ec3098645dce2bf05-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading2dc54e97ecbc631ec3098645dce2bf05-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#2dc54e97ecbc631ec3098645dce2bf05-trace-548f1e1d5357b" aria-expanded="true" aria-controls="2dc54e97ecbc631ec3098645dce2bf05-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="2dc54e97ecbc631ec3098645dce2bf05-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading2dc54e97ecbc631ec3098645dce2bf05-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/generis.rdf#GenerisRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6908e" aria-expanded="false" aria-controls="trace-id-548f1e1d6908e">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d6908e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6908e li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6908e prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d69490" aria-expanded="false" aria-controls="trace-id-548f1e1d69490">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d69490" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d69490 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d69490 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d69a5d" aria-expanded="false" aria-controls="trace-id-548f1e1d69a5d">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d69a5d" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d69a5d li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d69a5d prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6a15f" aria-expanded="false" aria-controls="trace-id-548f1e1d6a15f">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d6a15f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6a15f li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6a15f prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading4f1a156390f23bf0f3778e112254038a-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#4f1a156390f23bf0f3778e112254038a-call-548f1e1d5357b" aria-expanded="false" aria-controls="4f1a156390f23bf0f3778e112254038a-call-548f1e1d5357b">
                                    Call #15 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="4f1a156390f23bf0f3778e112254038a-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading4f1a156390f23bf0f3778e112254038a-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading4f1a156390f23bf0f3778e112254038a-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#4f1a156390f23bf0f3778e112254038a-trace-548f1e1d5357b" aria-expanded="true" aria-controls="4f1a156390f23bf0f3778e112254038a-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="4f1a156390f23bf0f3778e112254038a-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading4f1a156390f23bf0f3778e112254038a-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/generis.rdf#AnonymousRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6ab33" aria-expanded="false" aria-controls="trace-id-548f1e1d6ab33">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d6ab33" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6ab33 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6ab33 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6af2f" aria-expanded="false" aria-controls="trace-id-548f1e1d6af2f">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d6af2f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6af2f li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6af2f prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6b50c" aria-expanded="false" aria-controls="trace-id-548f1e1d6b50c">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d6b50c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6b50c li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6b50c prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6bc8b" aria-expanded="false" aria-controls="trace-id-548f1e1d6bc8b">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d6bc8b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6bc8b li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6bc8b prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading5a589bb7de53a1ea0004b092ae5eb42b-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#5a589bb7de53a1ea0004b092ae5eb42b-call-548f1e1d5357b" aria-expanded="false" aria-controls="5a589bb7de53a1ea0004b092ae5eb42b-call-548f1e1d5357b">
                                    Call #16 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="5a589bb7de53a1ea0004b092ae5eb42b-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading5a589bb7de53a1ea0004b092ae5eb42b-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading5a589bb7de53a1ea0004b092ae5eb42b-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#5a589bb7de53a1ea0004b092ae5eb42b-trace-548f1e1d5357b" aria-expanded="true" aria-controls="5a589bb7de53a1ea0004b092ae5eb42b-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="5a589bb7de53a1ea0004b092ae5eb42b-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading5a589bb7de53a1ea0004b092ae5eb42b-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#BackOfficeRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6cc21" aria-expanded="false" aria-controls="trace-id-548f1e1d6cc21">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d6cc21" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6cc21 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6cc21 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6d093" aria-expanded="false" aria-controls="trace-id-548f1e1d6d093">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d6d093" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6d093 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6d093 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6d63d" aria-expanded="false" aria-controls="trace-id-548f1e1d6d63d">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d6d63d" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6d63d li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6d63d prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6e083" aria-expanded="false" aria-controls="trace-id-548f1e1d6e083">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d6e083" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6e083 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6e083 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading6cf732553a98025bc5316b7172a41421-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#6cf732553a98025bc5316b7172a41421-call-548f1e1d5357b" aria-expanded="false" aria-controls="6cf732553a98025bc5316b7172a41421-call-548f1e1d5357b">
                                    Call #17 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="6cf732553a98025bc5316b7172a41421-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading6cf732553a98025bc5316b7172a41421-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading6cf732553a98025bc5316b7172a41421-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#6cf732553a98025bc5316b7172a41421-trace-548f1e1d5357b" aria-expanded="true" aria-controls="6cf732553a98025bc5316b7172a41421-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="6cf732553a98025bc5316b7172a41421-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading6cf732553a98025bc5316b7172a41421-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#FrontOfficeRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6ecd7" aria-expanded="false" aria-controls="trace-id-548f1e1d6ecd7">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d6ecd7" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6ecd7 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6ecd7 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6f173" aria-expanded="false" aria-controls="trace-id-548f1e1d6f173">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d6f173" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6f173 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6f173 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6f6ce" aria-expanded="false" aria-controls="trace-id-548f1e1d6f6ce">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d6f6ce" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6f6ce li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6f6ce prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d6fd7d" aria-expanded="false" aria-controls="trace-id-548f1e1d6fd7d">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d6fd7d" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d6fd7d li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d6fd7d prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading4f00f6e767f1e4ad5ce7e7768a13db53-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#4f00f6e767f1e4ad5ce7e7768a13db53-call-548f1e1d5357b" aria-expanded="false" aria-controls="4f00f6e767f1e4ad5ce7e7768a13db53-call-548f1e1d5357b">
                                    Call #18 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="4f00f6e767f1e4ad5ce7e7768a13db53-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading4f00f6e767f1e4ad5ce7e7768a13db53-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading4f00f6e767f1e4ad5ce7e7768a13db53-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#4f00f6e767f1e4ad5ce7e7768a13db53-trace-548f1e1d5357b" aria-expanded="true" aria-controls="4f00f6e767f1e4ad5ce7e7768a13db53-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="4f00f6e767f1e4ad5ce7e7768a13db53-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading4f00f6e767f1e4ad5ce7e7768a13db53-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#ServiceRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d707a8" aria-expanded="false" aria-controls="trace-id-548f1e1d707a8">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d707a8" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d707a8 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d707a8 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d70bcb" aria-expanded="false" aria-controls="trace-id-548f1e1d70bcb">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d70bcb" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d70bcb li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d70bcb prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d711d7" aria-expanded="false" aria-controls="trace-id-548f1e1d711d7">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d711d7" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d711d7 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d711d7 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d71927" aria-expanded="false" aria-controls="trace-id-548f1e1d71927">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d71927" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d71927 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d71927 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading684add7acb4cc390c59024491e36894d-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#684add7acb4cc390c59024491e36894d-call-548f1e1d5357b" aria-expanded="false" aria-controls="684add7acb4cc390c59024491e36894d-call-548f1e1d5357b">
                                    Call #19 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="684add7acb4cc390c59024491e36894d-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading684add7acb4cc390c59024491e36894d-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading684add7acb4cc390c59024491e36894d-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#684add7acb4cc390c59024491e36894d-trace-548f1e1d5357b" aria-expanded="true" aria-controls="684add7acb4cc390c59024491e36894d-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="684add7acb4cc390c59024491e36894d-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading684add7acb4cc390c59024491e36894d-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#BaseUserRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d72337" aria-expanded="false" aria-controls="trace-id-548f1e1d72337">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d72337" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d72337 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d72337 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d726c9" aria-expanded="false" aria-controls="trace-id-548f1e1d726c9">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d726c9" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d726c9 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d726c9 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d72d8a" aria-expanded="false" aria-controls="trace-id-548f1e1d72d8a">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d72d8a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d72d8a li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d72d8a prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d734fa" aria-expanded="false" aria-controls="trace-id-548f1e1d734fa">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d734fa" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d734fa li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d734fa prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading684bc6eefd3d5ab5c804e5094700b668-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#684bc6eefd3d5ab5c804e5094700b668-call-548f1e1d5357b" aria-expanded="false" aria-controls="684bc6eefd3d5ab5c804e5094700b668-call-548f1e1d5357b">
                                    Call #20 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="684bc6eefd3d5ab5c804e5094700b668-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading684bc6eefd3d5ab5c804e5094700b668-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading684bc6eefd3d5ab5c804e5094700b668-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#684bc6eefd3d5ab5c804e5094700b668-trace-548f1e1d5357b" aria-expanded="true" aria-controls="684bc6eefd3d5ab5c804e5094700b668-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="684bc6eefd3d5ab5c804e5094700b668-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading684bc6eefd3d5ab5c804e5094700b668-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#subRole13
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d73f29" aria-expanded="false" aria-controls="trace-id-548f1e1d73f29">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d73f29" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d73f29 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d73f29 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d74318" aria-expanded="false" aria-controls="trace-id-548f1e1d74318">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d74318" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d74318 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d74318 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d74920" aria-expanded="false" aria-controls="trace-id-548f1e1d74920">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d74920" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d74920 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d74920 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d75021" aria-expanded="false" aria-controls="trace-id-548f1e1d75021">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d75021" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d75021 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d75021 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading4e3882d72cb4a01e1001e7cb88b429a1-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#4e3882d72cb4a01e1001e7cb88b429a1-call-548f1e1d5357b" aria-expanded="false" aria-controls="4e3882d72cb4a01e1001e7cb88b429a1-call-548f1e1d5357b">
                                    Call #21 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="4e3882d72cb4a01e1001e7cb88b429a1-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading4e3882d72cb4a01e1001e7cb88b429a1-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading4e3882d72cb4a01e1001e7cb88b429a1-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#4e3882d72cb4a01e1001e7cb88b429a1-trace-548f1e1d5357b" aria-expanded="true" aria-controls="4e3882d72cb4a01e1001e7cb88b429a1-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="4e3882d72cb4a01e1001e7cb88b429a1-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading4e3882d72cb4a01e1001e7cb88b429a1-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#subRole2
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d75af6" aria-expanded="false" aria-controls="trace-id-548f1e1d75af6">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d75af6" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d75af6 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d75af6 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d75f47" aria-expanded="false" aria-controls="trace-id-548f1e1d75f47">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d75f47" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d75f47 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d75f47 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d764b3" aria-expanded="false" aria-controls="trace-id-548f1e1d764b3">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d764b3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d764b3 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d764b3 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d76ef7" aria-expanded="false" aria-controls="trace-id-548f1e1d76ef7">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d76ef7" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d76ef7 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d76ef7 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingf71c525d28da2b363fa431a6586e1b9c-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#f71c525d28da2b363fa431a6586e1b9c-call-548f1e1d5357b" aria-expanded="false" aria-controls="f71c525d28da2b363fa431a6586e1b9c-call-548f1e1d5357b">
                                    Call #22 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="f71c525d28da2b363fa431a6586e1b9c-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingf71c525d28da2b363fa431a6586e1b9c-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingf71c525d28da2b363fa431a6586e1b9c-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#f71c525d28da2b363fa431a6586e1b9c-trace-548f1e1d5357b" aria-expanded="true" aria-controls="f71c525d28da2b363fa431a6586e1b9c-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="f71c525d28da2b363fa431a6586e1b9c-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingf71c525d28da2b363fa431a6586e1b9c-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#baseRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d77927" aria-expanded="false" aria-controls="trace-id-548f1e1d77927">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d77927" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d77927 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d77927 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d77d8c" aria-expanded="false" aria-controls="trace-id-548f1e1d77d8c">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d77d8c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d77d8c li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d77d8c prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d78359" aria-expanded="false" aria-controls="trace-id-548f1e1d78359">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d78359" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d78359 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d78359 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d78a29" aria-expanded="false" aria-controls="trace-id-548f1e1d78a29">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d78a29" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d78a29 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d78a29 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingbea3fb27935490e75aae67bc16242edc-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#bea3fb27935490e75aae67bc16242edc-call-548f1e1d5357b" aria-expanded="false" aria-controls="bea3fb27935490e75aae67bc16242edc-call-548f1e1d5357b">
                                    Call #23 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="bea3fb27935490e75aae67bc16242edc-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingbea3fb27935490e75aae67bc16242edc-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingbea3fb27935490e75aae67bc16242edc-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#bea3fb27935490e75aae67bc16242edc-trace-548f1e1d5357b" aria-expanded="true" aria-controls="bea3fb27935490e75aae67bc16242edc-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="bea3fb27935490e75aae67bc16242edc-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingbea3fb27935490e75aae67bc16242edc-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#subRole12
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d79633" aria-expanded="false" aria-controls="trace-id-548f1e1d79633">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d79633" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d79633 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d79633 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d79d02" aria-expanded="false" aria-controls="trace-id-548f1e1d79d02">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d79d02" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d79d02 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d79d02 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d7a316" aria-expanded="false" aria-controls="trace-id-548f1e1d7a316">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d7a316" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d7a316 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d7a316 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d7aa6b" aria-expanded="false" aria-controls="trace-id-548f1e1d7aa6b">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d7aa6b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d7aa6b li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d7aa6b prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingd2a28b023e4de789e94c395f14015803-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#d2a28b023e4de789e94c395f14015803-call-548f1e1d5357b" aria-expanded="false" aria-controls="d2a28b023e4de789e94c395f14015803-call-548f1e1d5357b">
                                    Call #24 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="d2a28b023e4de789e94c395f14015803-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingd2a28b023e4de789e94c395f14015803-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingd2a28b023e4de789e94c395f14015803-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#d2a28b023e4de789e94c395f14015803-trace-548f1e1d5357b" aria-expanded="true" aria-controls="d2a28b023e4de789e94c395f14015803-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="d2a28b023e4de789e94c395f14015803-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingd2a28b023e4de789e94c395f14015803-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#subRole11
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d7b5ae" aria-expanded="false" aria-controls="trace-id-548f1e1d7b5ae">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d7b5ae" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d7b5ae li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d7b5ae prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d7bc4b" aria-expanded="false" aria-controls="trace-id-548f1e1d7bc4b">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d7bc4b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d7bc4b li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d7bc4b prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d7c2d3" aria-expanded="false" aria-controls="trace-id-548f1e1d7c2d3">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d7c2d3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d7c2d3 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d7c2d3 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d7ca57" aria-expanded="false" aria-controls="trace-id-548f1e1d7ca57">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d7ca57" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d7ca57 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d7ca57 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingb7178211f15f2f0643471456ceeccc3f-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#b7178211f15f2f0643471456ceeccc3f-call-548f1e1d5357b" aria-expanded="false" aria-controls="b7178211f15f2f0643471456ceeccc3f-call-548f1e1d5357b">
                                    Call #25 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="b7178211f15f2f0643471456ceeccc3f-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingb7178211f15f2f0643471456ceeccc3f-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingb7178211f15f2f0643471456ceeccc3f-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#b7178211f15f2f0643471456ceeccc3f-trace-548f1e1d5357b" aria-expanded="true" aria-controls="b7178211f15f2f0643471456ceeccc3f-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="b7178211f15f2f0643471456ceeccc3f-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingb7178211f15f2f0643471456ceeccc3f-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#subRole3
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d7d5a4" aria-expanded="false" aria-controls="trace-id-548f1e1d7d5a4">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d7d5a4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d7d5a4 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d7d5a4 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d7da49" aria-expanded="false" aria-controls="trace-id-548f1e1d7da49">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d7da49" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d7da49 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d7da49 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d7e369" aria-expanded="false" aria-controls="trace-id-548f1e1d7e369">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d7e369" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d7e369 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d7e369 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d7ea8e" aria-expanded="false" aria-controls="trace-id-548f1e1d7ea8e">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d7ea8e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d7ea8e li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d7ea8e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingb5e622f73db73ed8a19161d91f6d0852-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#b5e622f73db73ed8a19161d91f6d0852-call-548f1e1d5357b" aria-expanded="false" aria-controls="b5e622f73db73ed8a19161d91f6d0852-call-548f1e1d5357b">
                                    Call #26 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="b5e622f73db73ed8a19161d91f6d0852-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingb5e622f73db73ed8a19161d91f6d0852-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingb5e622f73db73ed8a19161d91f6d0852-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#b5e622f73db73ed8a19161d91f6d0852-trace-548f1e1d5357b" aria-expanded="true" aria-controls="b5e622f73db73ed8a19161d91f6d0852-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="b5e622f73db73ed8a19161d91f6d0852-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingb5e622f73db73ed8a19161d91f6d0852-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.dev/antoinetao.rdf#subRole1
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d7f5e6" aria-expanded="false" aria-controls="trace-id-548f1e1d7f5e6">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d7f5e6" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d7f5e6 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d7f5e6 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d7fac8" aria-expanded="false" aria-controls="trace-id-548f1e1d7fac8">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d7fac8" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d7fac8 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d7fac8 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d800bf" aria-expanded="false" aria-controls="trace-id-548f1e1d800bf">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d800bf" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d800bf li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d800bf prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d809b0" aria-expanded="false" aria-controls="trace-id-548f1e1d809b0">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d809b0" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d809b0 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d809b0 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading04f9016070eaa658a1459d3bd0bf6c2c-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#04f9016070eaa658a1459d3bd0bf6c2c-call-548f1e1d5357b" aria-expanded="false" aria-controls="04f9016070eaa658a1459d3bd0bf6c2c-call-548f1e1d5357b">
                                    Call #27 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="04f9016070eaa658a1459d3bd0bf6c2c-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading04f9016070eaa658a1459d3bd0bf6c2c-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading04f9016070eaa658a1459d3bd0bf6c2c-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#04f9016070eaa658a1459d3bd0bf6c2c-trace-548f1e1d5357b" aria-expanded="true" aria-controls="04f9016070eaa658a1459d3bd0bf6c2c-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="04f9016070eaa658a1459d3bd0bf6c2c-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading04f9016070eaa658a1459d3bd0bf6c2c-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#GlobalManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8134f" aria-expanded="false" aria-controls="trace-id-548f1e1d8134f">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d8134f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8134f li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8134f prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d819d9" aria-expanded="false" aria-controls="trace-id-548f1e1d819d9">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d819d9" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d819d9 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d819d9 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d81f9e" aria-expanded="false" aria-controls="trace-id-548f1e1d81f9e">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d81f9e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d81f9e li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d81f9e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8282b" aria-expanded="false" aria-controls="trace-id-548f1e1d8282b">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d8282b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8282b li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8282b prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading08d9c4737f7fa3d8715cf4d52fa542a8-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#08d9c4737f7fa3d8715cf4d52fa542a8-call-548f1e1d5357b" aria-expanded="false" aria-controls="08d9c4737f7fa3d8715cf4d52fa542a8-call-548f1e1d5357b">
                                    Call #28 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="08d9c4737f7fa3d8715cf4d52fa542a8-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading08d9c4737f7fa3d8715cf4d52fa542a8-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading08d9c4737f7fa3d8715cf4d52fa542a8-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#08d9c4737f7fa3d8715cf4d52fa542a8-trace-548f1e1d5357b" aria-expanded="true" aria-controls="08d9c4737f7fa3d8715cf4d52fa542a8-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="08d9c4737f7fa3d8715cf4d52fa542a8-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading08d9c4737f7fa3d8715cf4d52fa542a8-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#TaoManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8331d" aria-expanded="false" aria-controls="trace-id-548f1e1d8331d">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d8331d" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8331d li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8331d prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d837b4" aria-expanded="false" aria-controls="trace-id-548f1e1d837b4">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d837b4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d837b4 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d837b4 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d83d91" aria-expanded="false" aria-controls="trace-id-548f1e1d83d91">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d83d91" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d83d91 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d83d91 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d844a7" aria-expanded="false" aria-controls="trace-id-548f1e1d844a7">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d844a7" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d844a7 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d844a7 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingb476a7c74e411049d10cb1cfeb4c7eb4-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#b476a7c74e411049d10cb1cfeb4c7eb4-call-548f1e1d5357b" aria-expanded="false" aria-controls="b476a7c74e411049d10cb1cfeb4c7eb4-call-548f1e1d5357b">
                                    Call #29 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="b476a7c74e411049d10cb1cfeb4c7eb4-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingb476a7c74e411049d10cb1cfeb4c7eb4-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingb476a7c74e411049d10cb1cfeb4c7eb4-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#b476a7c74e411049d10cb1cfeb4c7eb4-trace-548f1e1d5357b" aria-expanded="true" aria-controls="b476a7c74e411049d10cb1cfeb4c7eb4-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="b476a7c74e411049d10cb1cfeb4c7eb4-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingb476a7c74e411049d10cb1cfeb4c7eb4-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/taoFuncACL.rdf#FuncAclManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d84ec5" aria-expanded="false" aria-controls="trace-id-548f1e1d84ec5">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d84ec5" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d84ec5 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d84ec5 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8527e" aria-expanded="false" aria-controls="trace-id-548f1e1d8527e">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d8527e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8527e li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8527e prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d858f4" aria-expanded="false" aria-controls="trace-id-548f1e1d858f4">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d858f4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d858f4 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d858f4 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d86024" aria-expanded="false" aria-controls="trace-id-548f1e1d86024">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d86024" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d86024 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d86024 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading1c95e7a3781a25adaa461232f4001d07-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#1c95e7a3781a25adaa461232f4001d07-call-548f1e1d5357b" aria-expanded="false" aria-controls="1c95e7a3781a25adaa461232f4001d07-call-548f1e1d5357b">
                                    Call #30 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="1c95e7a3781a25adaa461232f4001d07-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading1c95e7a3781a25adaa461232f4001d07-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading1c95e7a3781a25adaa461232f4001d07-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#1c95e7a3781a25adaa461232f4001d07-trace-548f1e1d5357b" aria-expanded="true" aria-controls="1c95e7a3781a25adaa461232f4001d07-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="1c95e7a3781a25adaa461232f4001d07-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading1c95e7a3781a25adaa461232f4001d07-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOItem.rdf#ItemsManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d86a4a" aria-expanded="false" aria-controls="trace-id-548f1e1d86a4a">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d86a4a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d86a4a li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d86a4a prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d86e1c" aria-expanded="false" aria-controls="trace-id-548f1e1d86e1c">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d86e1c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d86e1c li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d86e1c prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d873a7" aria-expanded="false" aria-controls="trace-id-548f1e1d873a7">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d873a7" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d873a7 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d873a7 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d88056" aria-expanded="false" aria-controls="trace-id-548f1e1d88056">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d88056" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d88056 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d88056 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading2ab0bce2acb3c4deda2c32aa6a781f19-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#2ab0bce2acb3c4deda2c32aa6a781f19-call-548f1e1d5357b" aria-expanded="false" aria-controls="2ab0bce2acb3c4deda2c32aa6a781f19-call-548f1e1d5357b">
                                    Call #31 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="2ab0bce2acb3c4deda2c32aa6a781f19-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading2ab0bce2acb3c4deda2c32aa6a781f19-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading2ab0bce2acb3c4deda2c32aa6a781f19-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#2ab0bce2acb3c4deda2c32aa6a781f19-trace-548f1e1d5357b" aria-expanded="true" aria-controls="2ab0bce2acb3c4deda2c32aa6a781f19-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="2ab0bce2acb3c4deda2c32aa6a781f19-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading2ab0bce2acb3c4deda2c32aa6a781f19-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOItem.rdf#QTIManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d88af5" aria-expanded="false" aria-controls="trace-id-548f1e1d88af5">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d88af5" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d88af5 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d88af5 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d89018" aria-expanded="false" aria-controls="trace-id-548f1e1d89018">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d89018" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d89018 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d89018 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d895da" aria-expanded="false" aria-controls="trace-id-548f1e1d895da">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d895da" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d895da li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d895da prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d89cc9" aria-expanded="false" aria-controls="trace-id-548f1e1d89cc9">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d89cc9" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d89cc9 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d89cc9 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading17d404049713db8c5a8ff1e3a1c75b5d-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#17d404049713db8c5a8ff1e3a1c75b5d-call-548f1e1d5357b" aria-expanded="false" aria-controls="17d404049713db8c5a8ff1e3a1c75b5d-call-548f1e1d5357b">
                                    Call #32 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="17d404049713db8c5a8ff1e3a1c75b5d-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading17d404049713db8c5a8ff1e3a1c75b5d-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading17d404049713db8c5a8ff1e3a1c75b5d-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#17d404049713db8c5a8ff1e3a1c75b5d-trace-548f1e1d5357b" aria-expanded="true" aria-controls="17d404049713db8c5a8ff1e3a1c75b5d-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="17d404049713db8c5a8ff1e3a1c75b5d-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading17d404049713db8c5a8ff1e3a1c75b5d-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/generis.rdf#qtiItemPciManager
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8aa0f" aria-expanded="false" aria-controls="trace-id-548f1e1d8aa0f">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d8aa0f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8aa0f li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8aa0f prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8ae58" aria-expanded="false" aria-controls="trace-id-548f1e1d8ae58">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d8ae58" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8ae58 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8ae58 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8b835" aria-expanded="false" aria-controls="trace-id-548f1e1d8b835">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d8b835" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8b835 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8b835 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8bff4" aria-expanded="false" aria-controls="trace-id-548f1e1d8bff4">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d8bff4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8bff4 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8bff4 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading025568153b905397d6f9a8789a7cb27d-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#025568153b905397d6f9a8789a7cb27d-call-548f1e1d5357b" aria-expanded="false" aria-controls="025568153b905397d6f9a8789a7cb27d-call-548f1e1d5357b">
                                    Call #33 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="025568153b905397d6f9a8789a7cb27d-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading025568153b905397d6f9a8789a7cb27d-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading025568153b905397d6f9a8789a7cb27d-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#025568153b905397d6f9a8789a7cb27d-trace-548f1e1d5357b" aria-expanded="true" aria-controls="025568153b905397d6f9a8789a7cb27d-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="025568153b905397d6f9a8789a7cb27d-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading025568153b905397d6f9a8789a7cb27d-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOItem.rdf#OWIManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8caae" aria-expanded="false" aria-controls="trace-id-548f1e1d8caae">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d8caae" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8caae li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8caae prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8d051" aria-expanded="false" aria-controls="trace-id-548f1e1d8d051">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d8d051" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8d051 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8d051 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8d65a" aria-expanded="false" aria-controls="trace-id-548f1e1d8d65a">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d8d65a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8d65a li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8d65a prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8deb7" aria-expanded="false" aria-controls="trace-id-548f1e1d8deb7">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d8deb7" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8deb7 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8deb7 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headinga2b9a54cf5e6241a83354a70573caade-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#a2b9a54cf5e6241a83354a70573caade-call-548f1e1d5357b" aria-expanded="false" aria-controls="a2b9a54cf5e6241a83354a70573caade-call-548f1e1d5357b">
                                    Call #34 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="a2b9a54cf5e6241a83354a70573caade-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headinga2b9a54cf5e6241a83354a70573caade-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headinga2b9a54cf5e6241a83354a70573caade-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#a2b9a54cf5e6241a83354a70573caade-trace-548f1e1d5357b" aria-expanded="true" aria-controls="a2b9a54cf5e6241a83354a70573caade-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="a2b9a54cf5e6241a83354a70573caade-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headinga2b9a54cf5e6241a83354a70573caade-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOTest.rdf#TestsManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8e9d6" aria-expanded="false" aria-controls="trace-id-548f1e1d8e9d6">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d8e9d6" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8e9d6 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8e9d6 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8ee62" aria-expanded="false" aria-controls="trace-id-548f1e1d8ee62">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d8ee62" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8ee62 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8ee62 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8f407" aria-expanded="false" aria-controls="trace-id-548f1e1d8f407">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d8f407" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8f407 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8f407 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d8fb2c" aria-expanded="false" aria-controls="trace-id-548f1e1d8fb2c">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d8fb2c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d8fb2c li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d8fb2c prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headinge3d69483fe16eab27ed677bde07ab5c0-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#e3d69483fe16eab27ed677bde07ab5c0-call-548f1e1d5357b" aria-expanded="false" aria-controls="e3d69483fe16eab27ed677bde07ab5c0-call-548f1e1d5357b">
                                    Call #35 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="e3d69483fe16eab27ed677bde07ab5c0-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headinge3d69483fe16eab27ed677bde07ab5c0-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headinge3d69483fe16eab27ed677bde07ab5c0-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#e3d69483fe16eab27ed677bde07ab5c0-trace-548f1e1d5357b" aria-expanded="true" aria-controls="e3d69483fe16eab27ed677bde07ab5c0-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="e3d69483fe16eab27ed677bde07ab5c0-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headinge3d69483fe16eab27ed677bde07ab5c0-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOTest.rdf#TaoQtiManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d90681" aria-expanded="false" aria-controls="trace-id-548f1e1d90681">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d90681" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d90681 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d90681 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d90b14" aria-expanded="false" aria-controls="trace-id-548f1e1d90b14">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d90b14" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d90b14 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d90b14 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d91503" aria-expanded="false" aria-controls="trace-id-548f1e1d91503">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d91503" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d91503 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d91503 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d91bbb" aria-expanded="false" aria-controls="trace-id-548f1e1d91bbb">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d91bbb" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d91bbb li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d91bbb prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading2d3b15434bd7c96ea08e0e73ae74caa6-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#2d3b15434bd7c96ea08e0e73ae74caa6-call-548f1e1d5357b" aria-expanded="false" aria-controls="2d3b15434bd7c96ea08e0e73ae74caa6-call-548f1e1d5357b">
                                    Call #36 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="2d3b15434bd7c96ea08e0e73ae74caa6-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading2d3b15434bd7c96ea08e0e73ae74caa6-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading2d3b15434bd7c96ea08e0e73ae74caa6-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#2d3b15434bd7c96ea08e0e73ae74caa6-trace-548f1e1d5357b" aria-expanded="true" aria-controls="2d3b15434bd7c96ea08e0e73ae74caa6-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="2d3b15434bd7c96ea08e0e73ae74caa6-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading2d3b15434bd7c96ea08e0e73ae74caa6-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/middleware/wfEngine.rdf#WorkflowsManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d92642" aria-expanded="false" aria-controls="trace-id-548f1e1d92642">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d92642" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d92642 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d92642 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d92abf" aria-expanded="false" aria-controls="trace-id-548f1e1d92abf">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d92abf" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d92abf li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d92abf prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d9302b" aria-expanded="false" aria-controls="trace-id-548f1e1d9302b">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d9302b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d9302b li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d9302b prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d9378c" aria-expanded="false" aria-controls="trace-id-548f1e1d9378c">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d9378c" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d9378c li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d9378c prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading6ff8f3d751b2667baf2008f245a44a56-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#6ff8f3d751b2667baf2008f245a44a56-call-548f1e1d5357b" aria-expanded="false" aria-controls="6ff8f3d751b2667baf2008f245a44a56-call-548f1e1d5357b">
                                    Call #37 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="6ff8f3d751b2667baf2008f245a44a56-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading6ff8f3d751b2667baf2008f245a44a56-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading6ff8f3d751b2667baf2008f245a44a56-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#6ff8f3d751b2667baf2008f245a44a56-trace-548f1e1d5357b" aria-expanded="true" aria-controls="6ff8f3d751b2667baf2008f245a44a56-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="6ff8f3d751b2667baf2008f245a44a56-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading6ff8f3d751b2667baf2008f245a44a56-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOSubject.rdf#SubjectsManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d94509" aria-expanded="false" aria-controls="trace-id-548f1e1d94509">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d94509" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d94509 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d94509 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d94998" aria-expanded="false" aria-controls="trace-id-548f1e1d94998">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d94998" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d94998 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d94998 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d950c2" aria-expanded="false" aria-controls="trace-id-548f1e1d950c2">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d950c2" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d950c2 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d950c2 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d957b4" aria-expanded="false" aria-controls="trace-id-548f1e1d957b4">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d957b4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d957b4 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d957b4 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading237c49e3d2e4156b746b8cd8729ee879-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#237c49e3d2e4156b746b8cd8729ee879-call-548f1e1d5357b" aria-expanded="false" aria-controls="237c49e3d2e4156b746b8cd8729ee879-call-548f1e1d5357b">
                                    Call #38 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="237c49e3d2e4156b746b8cd8729ee879-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading237c49e3d2e4156b746b8cd8729ee879-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading237c49e3d2e4156b746b8cd8729ee879-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#237c49e3d2e4156b746b8cd8729ee879-trace-548f1e1d5357b" aria-expanded="true" aria-controls="237c49e3d2e4156b746b8cd8729ee879-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="237c49e3d2e4156b746b8cd8729ee879-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading237c49e3d2e4156b746b8cd8729ee879-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOGroup.rdf#GroupsManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d96226" aria-expanded="false" aria-controls="trace-id-548f1e1d96226">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d96226" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d96226 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d96226 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d966db" aria-expanded="false" aria-controls="trace-id-548f1e1d966db">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d966db" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d966db li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d966db prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d96d19" aria-expanded="false" aria-controls="trace-id-548f1e1d96d19">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d96d19" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d96d19 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d96d19 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d97412" aria-expanded="false" aria-controls="trace-id-548f1e1d97412">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d97412" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d97412 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d97412 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading348e71674d151aa08e354472144adddf-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#348e71674d151aa08e354472144adddf-call-548f1e1d5357b" aria-expanded="false" aria-controls="348e71674d151aa08e354472144adddf-call-548f1e1d5357b">
                                    Call #39 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="348e71674d151aa08e354472144adddf-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading348e71674d151aa08e354472144adddf-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading348e71674d151aa08e354472144adddf-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#348e71674d151aa08e354472144adddf-trace-548f1e1d5357b" aria-expanded="true" aria-controls="348e71674d151aa08e354472144adddf-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="348e71674d151aa08e354472144adddf-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading348e71674d151aa08e354472144adddf-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOResultServer.rdf#ResultServerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d97f9e" aria-expanded="false" aria-controls="trace-id-548f1e1d97f9e">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d97f9e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d97f9e li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d97f9e prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d98408" aria-expanded="false" aria-controls="trace-id-548f1e1d98408">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d98408" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d98408 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d98408 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d989ce" aria-expanded="false" aria-controls="trace-id-548f1e1d989ce">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d989ce" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d989ce li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d989ce prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d99128" aria-expanded="false" aria-controls="trace-id-548f1e1d99128">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d99128" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d99128 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d99128 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingdcedcbbb9469abe450c13130a8bf74d1-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#dcedcbbb9469abe450c13130a8bf74d1-call-548f1e1d5357b" aria-expanded="false" aria-controls="dcedcbbb9469abe450c13130a8bf74d1-call-548f1e1d5357b">
                                    Call #40 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="dcedcbbb9469abe450c13130a8bf74d1-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingdcedcbbb9469abe450c13130a8bf74d1-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingdcedcbbb9469abe450c13130a8bf74d1-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#dcedcbbb9469abe450c13130a8bf74d1-trace-548f1e1d5357b" aria-expanded="true" aria-controls="dcedcbbb9469abe450c13130a8bf74d1-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="dcedcbbb9469abe450c13130a8bf74d1-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingdcedcbbb9469abe450c13130a8bf74d1-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/generis.rdf#taoOutcomeResultsManager
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d99c23" aria-expanded="false" aria-controls="trace-id-548f1e1d99c23">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d99c23" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d99c23 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d99c23 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d9a0b4" aria-expanded="false" aria-controls="trace-id-548f1e1d9a0b4">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d9a0b4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d9a0b4 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d9a0b4 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d9a63f" aria-expanded="false" aria-controls="trace-id-548f1e1d9a63f">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d9a63f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d9a63f li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d9a63f prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d9ace4" aria-expanded="false" aria-controls="trace-id-548f1e1d9ace4">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d9ace4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d9ace4 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d9ace4 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading8b6630767571ff5be3335dc27d058c66-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#8b6630767571ff5be3335dc27d058c66-call-548f1e1d5357b" aria-expanded="false" aria-controls="8b6630767571ff5be3335dc27d058c66-call-548f1e1d5357b">
                                    Call #41 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="8b6630767571ff5be3335dc27d058c66-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading8b6630767571ff5be3335dc27d058c66-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading8b6630767571ff5be3335dc27d058c66-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#8b6630767571ff5be3335dc27d058c66-trace-548f1e1d5357b" aria-expanded="true" aria-controls="8b6630767571ff5be3335dc27d058c66-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="8b6630767571ff5be3335dc27d058c66-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading8b6630767571ff5be3335dc27d058c66-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOTest.rdf#WfTestManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d9b803" aria-expanded="false" aria-controls="trace-id-548f1e1d9b803">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d9b803" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d9b803 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d9b803 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d9bcbe" aria-expanded="false" aria-controls="trace-id-548f1e1d9bcbe">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d9bcbe" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d9bcbe li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d9bcbe prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d9c32a" aria-expanded="false" aria-controls="trace-id-548f1e1d9c32a">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1d9c32a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d9c32a li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d9c32a prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d9de24" aria-expanded="false" aria-controls="trace-id-548f1e1d9de24">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1d9de24" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d9de24 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d9de24 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading7be247f5d007c77bde1214b28574f61d-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#7be247f5d007c77bde1214b28574f61d-call-548f1e1d5357b" aria-expanded="false" aria-controls="7be247f5d007c77bde1214b28574f61d-call-548f1e1d5357b">
                                    Call #42 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="7be247f5d007c77bde1214b28574f61d-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading7be247f5d007c77bde1214b28574f61d-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading7be247f5d007c77bde1214b28574f61d-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#7be247f5d007c77bde1214b28574f61d-trace-548f1e1d5357b" aria-expanded="true" aria-controls="7be247f5d007c77bde1214b28574f61d-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="7be247f5d007c77bde1214b28574f61d-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading7be247f5d007c77bde1214b28574f61d-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d9f3e8" aria-expanded="false" aria-controls="trace-id-548f1e1d9f3e8">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1d9f3e8" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d9f3e8 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d9f3e8 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1d9fed3" aria-expanded="false" aria-controls="trace-id-548f1e1d9fed3">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1d9fed3" class="collapse">
                        <style>
                            .classtrace-id-548f1e1d9fed3 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1d9fed3 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da0571" aria-expanded="false" aria-controls="trace-id-548f1e1da0571">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1da0571" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da0571 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da0571 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da1079" aria-expanded="false" aria-controls="trace-id-548f1e1da1079">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1da1079" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da1079 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da1079 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading3940939c9b632d9aea251a9171e7e179-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#3940939c9b632d9aea251a9171e7e179-call-548f1e1d5357b" aria-expanded="false" aria-controls="3940939c9b632d9aea251a9171e7e179-call-548f1e1d5357b">
                                    Call #43 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="3940939c9b632d9aea251a9171e7e179-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading3940939c9b632d9aea251a9171e7e179-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading3940939c9b632d9aea251a9171e7e179-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#3940939c9b632d9aea251a9171e7e179-trace-548f1e1d5357b" aria-expanded="true" aria-controls="3940939c9b632d9aea251a9171e7e179-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="3940939c9b632d9aea251a9171e7e179-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading3940939c9b632d9aea251a9171e7e179-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAOResult.rdf#ResultsManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da1b80" aria-expanded="false" aria-controls="trace-id-548f1e1da1b80">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1da1b80" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da1b80 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da1b80 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da20f4" aria-expanded="false" aria-controls="trace-id-548f1e1da20f4">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1da20f4" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da20f4 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da20f4 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da2d1e" aria-expanded="false" aria-controls="trace-id-548f1e1da2d1e">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1da2d1e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da2d1e li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da2d1e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da366e" aria-expanded="false" aria-controls="trace-id-548f1e1da366e">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1da366e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da366e li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da366e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading7bbcd9b4a13b309061d50902c5aa5f2e-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#7bbcd9b4a13b309061d50902c5aa5f2e-call-548f1e1d5357b" aria-expanded="false" aria-controls="7bbcd9b4a13b309061d50902c5aa5f2e-call-548f1e1d5357b">
                                    Call #44 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="7bbcd9b4a13b309061d50902c5aa5f2e-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading7bbcd9b4a13b309061d50902c5aa5f2e-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading7bbcd9b4a13b309061d50902c5aa5f2e-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#7bbcd9b4a13b309061d50902c5aa5f2e-trace-548f1e1d5357b" aria-expanded="true" aria-controls="7bbcd9b4a13b309061d50902c5aa5f2e-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="7bbcd9b4a13b309061d50902c5aa5f2e-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading7bbcd9b4a13b309061d50902c5aa5f2e-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAODelivery.rdf#taoSimpleDeliveryManagerRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da412f" aria-expanded="false" aria-controls="trace-id-548f1e1da412f">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1da412f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da412f li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da412f prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da461d" aria-expanded="false" aria-controls="trace-id-548f1e1da461d">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1da461d" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da461d li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da461d prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da4c35" aria-expanded="false" aria-controls="trace-id-548f1e1da4c35">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1da4c35" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da4c35 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da4c35 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da550e" aria-expanded="false" aria-controls="trace-id-548f1e1da550e">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1da550e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da550e li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da550e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading96bc889c46bb772574604e9c923e5830-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#96bc889c46bb772574604e9c923e5830-call-548f1e1d5357b" aria-expanded="false" aria-controls="96bc889c46bb772574604e9c923e5830-call-548f1e1d5357b">
                                    Call #45 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="96bc889c46bb772574604e9c923e5830-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading96bc889c46bb772574604e9c923e5830-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading96bc889c46bb772574604e9c923e5830-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#96bc889c46bb772574604e9c923e5830-trace-548f1e1d5357b" aria-expanded="true" aria-controls="96bc889c46bb772574604e9c923e5830-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="96bc889c46bb772574604e9c923e5830-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading96bc889c46bb772574604e9c923e5830-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/generis.rdf#taoCeManager
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da5fa8" aria-expanded="false" aria-controls="trace-id-548f1e1da5fa8">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1da5fa8" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da5fa8 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da5fa8 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da6704" aria-expanded="false" aria-controls="trace-id-548f1e1da6704">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1da6704" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da6704 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da6704 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da704b" aria-expanded="false" aria-controls="trace-id-548f1e1da704b">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1da704b" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da704b li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da704b prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da7806" aria-expanded="false" aria-controls="trace-id-548f1e1da7806">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1da7806" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da7806 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da7806 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading42af383811a110c962539e1fbc5bff97-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#42af383811a110c962539e1fbc5bff97-call-548f1e1d5357b" aria-expanded="false" aria-controls="42af383811a110c962539e1fbc5bff97-call-548f1e1d5357b">
                                    Call #46 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="42af383811a110c962539e1fbc5bff97-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading42af383811a110c962539e1fbc5bff97-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading42af383811a110c962539e1fbc5bff97-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#42af383811a110c962539e1fbc5bff97-trace-548f1e1d5357b" aria-expanded="true" aria-controls="42af383811a110c962539e1fbc5bff97-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="42af383811a110c962539e1fbc5bff97-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading42af383811a110c962539e1fbc5bff97-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#SysAdminRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da8426" aria-expanded="false" aria-controls="trace-id-548f1e1da8426">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1da8426" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da8426 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da8426 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da8946" aria-expanded="false" aria-controls="trace-id-548f1e1da8946">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1da8946" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da8946 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da8946 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da8f9d" aria-expanded="false" aria-controls="trace-id-548f1e1da8f9d">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1da8f9d" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da8f9d li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da8f9d prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1da9732" aria-expanded="false" aria-controls="trace-id-548f1e1da9732">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1da9732" class="collapse">
                        <style>
                            .classtrace-id-548f1e1da9732 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1da9732 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="heading012f0b4de47a003fda59cfc46150f456-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#012f0b4de47a003fda59cfc46150f456-call-548f1e1d5357b" aria-expanded="false" aria-controls="012f0b4de47a003fda59cfc46150f456-call-548f1e1d5357b">
                                    Call #47 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="012f0b4de47a003fda59cfc46150f456-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading012f0b4de47a003fda59cfc46150f456-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="heading012f0b4de47a003fda59cfc46150f456-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#012f0b4de47a003fda59cfc46150f456-trace-548f1e1d5357b" aria-expanded="true" aria-controls="012f0b4de47a003fda59cfc46150f456-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="012f0b4de47a003fda59cfc46150f456-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading012f0b4de47a003fda59cfc46150f456-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/generis.rdf#taoDacSimpleManager
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1daa276" aria-expanded="false" aria-controls="trace-id-548f1e1daa276">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1daa276" class="collapse">
                        <style>
                            .classtrace-id-548f1e1daa276 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1daa276 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1daa7d0" aria-expanded="false" aria-controls="trace-id-548f1e1daa7d0">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1daa7d0" class="collapse">
                        <style>
                            .classtrace-id-548f1e1daa7d0 li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1daa7d0 prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1daae86" aria-expanded="false" aria-controls="trace-id-548f1e1daae86">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1daae86" class="collapse">
                        <style>
                            .classtrace-id-548f1e1daae86 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1daae86 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1dab69e" aria-expanded="false" aria-controls="trace-id-548f1e1dab69e">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1dab69e" class="collapse">
                        <style>
                            .classtrace-id-548f1e1dab69e li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1dab69e prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingcf1c5ad3843280ddf1c70090225fffef-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#cf1c5ad3843280ddf1c70090225fffef-call-548f1e1d5357b" aria-expanded="false" aria-controls="cf1c5ad3843280ddf1c70090225fffef-call-548f1e1d5357b">
                                    Call #48 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="cf1c5ad3843280ddf1c70090225fffef-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingcf1c5ad3843280ddf1c70090225fffef-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingcf1c5ad3843280ddf1c70090225fffef-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#cf1c5ad3843280ddf1c70090225fffef-trace-548f1e1d5357b" aria-expanded="true" aria-controls="cf1c5ad3843280ddf1c70090225fffef-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="cf1c5ad3843280ddf1c70090225fffef-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingcf1c5ad3843280ddf1c70090225fffef-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#DeliveryRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1dac2cd" aria-expanded="false" aria-controls="trace-id-548f1e1dac2cd">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1dac2cd" class="collapse">
                        <style>
                            .classtrace-id-548f1e1dac2cd li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1dac2cd prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1daca1a" aria-expanded="false" aria-controls="trace-id-548f1e1daca1a">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1daca1a" class="collapse">
                        <style>
                            .classtrace-id-548f1e1daca1a li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1daca1a prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1dad097" aria-expanded="false" aria-controls="trace-id-548f1e1dad097">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1dad097" class="collapse">
                        <style>
                            .classtrace-id-548f1e1dad097 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1dad097 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1dad7f7" aria-expanded="false" aria-controls="trace-id-548f1e1dad7f7">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1dad7f7" class="collapse">
                        <style>
                            .classtrace-id-548f1e1dad7f7 li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1dad7f7 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                    
                    <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingfbfafb110acbf6f39bc45fcc921cc820-call-548f1e1d5357b">
                            <h4 class="panel-title">
                                <a data-toggle="collapse" data-parent="#accordion-method-548f1e1d5357b" href="#fbfafb110acbf6f39bc45fcc921cc820-call-548f1e1d5357b" aria-expanded="false" aria-controls="fbfafb110acbf6f39bc45fcc921cc820-call-548f1e1d5357b">
                                    Call #49 (2 calls)
                                </a>
                            </h4>
                        </div>
                        <div id="fbfafb110acbf6f39bc45fcc921cc820-call-548f1e1d5357b" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingfbfafb110acbf6f39bc45fcc921cc820-call-548f1e1d5357b">
                            <div class="panel-body">
                                <div class="panel-group" id="accordion-trace-548f1e1d5357b" role="tablist" aria-multiselectable="true">
                                    <div class="panel panel-default">
                                        <div class="panel-heading" role="tab" id="headingfbfafb110acbf6f39bc45fcc921cc820-trace-548f1e1d5357b">
                                            <h4 class="panel-title">
                                                <a data-toggle="collapse" data-parent="#accordion-trace-548f1e1d5357b" href="#fbfafb110acbf6f39bc45fcc921cc820-trace-548f1e1d5357b" aria-expanded="true" aria-controls="fbfafb110acbf6f39bc45fcc921cc820-trace-548f1e1d5357b">
                                                    Parameters :
                                                </a>
                                            </h4>
                                        </div>
                                        <div id="fbfafb110acbf6f39bc45fcc921cc820-trace-548f1e1d5357b" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingfbfafb110acbf6f39bc45fcc921cc820-trace-548f1e1d5357b">
                                            <div class="panel-body">
                                                <pre>Array
(
    [0] => SELECT object, l_language
        			FROM statements 
		    		WHERE subject = ? 
		    		AND predicate = ?
					AND ( l_language = ? OR l_language = '' OR l_language = 'en-US' )
		    		AND modelid IN (1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16) ORDER BY id DESC LIMIT 1 OFFSET 0
    [1] => Array
        (
            [0] => http://www.tao.lu/Ontologies/TAO.rdf#WorkflowRole
            [1] => http://www.w3.org/2000/01/rdf-schema#label
            [2] => en-US
        )

)
</pre>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    <ul>
        <li>
        <img src="http://yuml.me/diagram/plain/activity/(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::160\rinitElements)-1>(tao/actions/form\rclass.Instance.php::128\relementMap)-1>(tao/helpers/form\rclass.GenerisFormFactory.php::111\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue),(taoTestTaker/actions/form\rTestTaker.php::45\rinitElements)-1>(tao/actions/form\rclass.Users.php::210\rgetLabel)-1>(generis/core/kernel/classes\rclass.Resource.php::285\rgetOnePropertyValue)">
    </li>
    <li>
    <span>Common starting trace :</span>
        <ul>
                <li>&nbsp; => query [/var/www/generis/core/kernel/persistence/smoothsql/class.Resource.php (123)]</li>
                <li>&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp; => getPropertyValues [/var/www/generis/core/kernel/classes/class.Resource.php (463)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => getOnePropertyValue [/var/www/generis/core/kernel/classes/class.Resource.php (285)]</li>
            </ul>
    </li>


        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1dae333" aria-expanded="false" aria-controls="trace-id-548f1e1dae333">
                        getLabel [/var/www/tao/helpers/form/class.GenerisFormFactory.php (111)]
                    </a>
                                        <div id="trace-id-548f1e1dae333" class="collapse">
                        <style>
                            .classtrace-id-548f1e1dae333 li:nth-child(60 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1dae333 prettyprint linenums:52 linenums">    public static function elementMap( core_kernel_classes_Property $property)
    {
        $returnValue = null;

        
		
		//create the element from the right widget
		$property->feed();
		
        $widgetResource = $property->getWidget();
		if(is_null($widgetResource)){
			return null;
		}
		
		
		$widget = substr($widgetResource->getUri(), strrpos($widgetResource->getUri(), '#') + 1 );
		if($widget != 'AsyncFile'){
			//@TODO: quick fix to make AsyncFile work, need to clean that!!
			$widget = ucfirst(strtolower($widget));
		}
		else
		{
			$widget = 'GenerisAsyncFile';
		}
		
		//authoring widget is not used in standalone mode
		if($widget == 'Authoring' && tao_helpers_Context::check('STANDALONE_MODE')){
			return null;
		}
		
		$element = tao_helpers_form_FormFactory::getElement(tao_helpers_Uri::encode($property->getUri()), $widget);
		
		if(!is_null($element)){
		    if($element->getWidget() != $widgetResource->getUri()){
                common_Logger::w('Widget definition differs from implementation: '.$element->getWidget().' != '.$widgetResource->getUri());
		        return null;
			}
				
			//use the property label as element description
			$propDesc = (strlen(trim($property->getLabel())) > 0) ? $property->getLabel() : str_replace(LOCAL_NAMESPACE, '', $property->getUri());
			$element->setDescription($propDesc);
			
			//multi elements use the property range as options
			if(method_exists($element, 'setOptions')){
				$range = $property->getRange();
				
				if($range != null){
					$options = array();
					
					if($element instanceof tao_helpers_form_elements_Treeview){
						if($property->getUri() == RDFS_RANGE){
							$options = self::rangeToTree(new core_kernel_classes_Class(RDFS_RESOURCE));
						}
						else{
							$options = self::rangeToTree($range);
						}
					}
					else{
						foreach($range->getInstances(true) as $rangeInstance){
							$options[ tao_helpers_Uri::encode($rangeInstance->getUri()) ] = $rangeInstance->getLabel();
						}
						//set the default value to an empty space
						if(method_exists($element, 'setEmptyOption')){
							$element->setEmptyOption(' ');
						}
					}
					
					//complete the options listing
					$element->setOptions($options);
				}
			}
			$returnValue = $element;
		}
		
        

        return $returnValue;
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1dae82d" aria-expanded="false" aria-controls="trace-id-548f1e1dae82d">
                        elementMap [/var/www/tao/actions/form/class.Instance.php (128)]
                    </a>
                                        <div id="trace-id-548f1e1dae82d" class="collapse">
                        <style>
                            .classtrace-id-548f1e1dae82d li:nth-child(42 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1dae82d prettyprint linenums:87 linenums">    protected function initElements()
    {
        
        
    	
    	$clazz = $this->getClazz();
    	$instance = $this->getInstance();
    	$guiOrderProperty = new core_kernel_classes_Property(TAO_GUIORDER_PROP);
    	
    	//get the list of properties to set in the form
		$propertyCandidates = tao_helpers_form_GenerisFormFactory::getDefaultProperties();
		
		$classProperties = tao_helpers_form_GenerisFormFactory::getClassProperties($clazz, $this->getTopClazz());
		$propertyCandidates = array_merge($propertyCandidates, $classProperties);
		
		$additionalProperties = (isset($this->options['additionalProperties']) && is_array($this->options['additionalProperties']))?$this->options['additionalProperties']:array();
		if(!empty($additionalProperties)){
			$propertyCandidates = array_merge($propertyCandidates, $additionalProperties);
		}
		
		$excludedProperties = (isset($this->options['excludedProperties']) && is_array($this->options['excludedProperties']))?$this->options['excludedProperties']:array();
		$editedProperties = array();
		foreach($propertyCandidates as $property){
			if(!isset($editedProperties[$property->getUri()]) && !in_array($property->getUri(), $excludedProperties)){
				$editedProperties[$property->getUri()] = $property;
			}
		}
			
		$finalElements = array();
    	foreach($editedProperties as $property){

			$property->feed();
			$widget = $property->getWidget();
			if($widget == null || $widget instanceof core_kernel_classes_Literal) {
				continue;
			}
			else if ($widget instanceof core_kernel_classes_Resource &&	$widget->getUri() == WIDGET_TREEVIEW){
			    continue;
			}
			
			//map properties widgets to form elments 
			$element = tao_helpers_form_GenerisFormFactory::elementMap($property);
			
			if(!is_null($element)){
				
				//take instance values to populate the form
				if(!is_null($instance)){
					
					$values = $instance->getPropertyValuesCollection($property);
					foreach($values->getIterator() as $value){
						if(!is_null($value)){
							if($value instanceof core_kernel_classes_Resource){
								if($element instanceof tao_helpers_form_elements_Readonly){
									$element->setValue($value->getLabel());
								}else{
									$element->setValue($value->getUri());
								}
							}
							if($value instanceof core_kernel_classes_Literal){
								$element->setValue((string)$value);
							}
						}
					}
				}
					
				//set label validator
				if($property->getUri() == RDFS_LABEL){
					$element->setDescription(__('Label *'));
					$element->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
				}

				// don't show empty labels
				if($element instanceof tao_helpers_form_elements_Label && strlen($element->getRawValue()) == 0) {
					continue;
				}
				
				//set file element validator:
				if($element instanceof tao_helpers_form_elements_AsyncFile){
					
				}
				
				if ($property->getUri() == RDFS_LABEL){
					// Label will not be a TAO Property. However, it should
					// be always first.
					array_splice($finalElements, 0, 0, array(array($element, 1)));
				}
				else if (count($guiOrderPropertyValues = $property->getPropertyValues($guiOrderProperty))){
					
					// get position of this property if it has one.
					$position = intval($guiOrderPropertyValues[0]);
					
					// insert the element at the right place.
					$i = 0;
					while ($i < count($finalElements) && ($position >= $finalElements[$i][1] && $finalElements[$i][1] !== null)){
						$i++;
					}
					
					array_splice($finalElements, $i, 0, array(array($element, $position)));
				}
				else{
					// Unordered properties will go at the end of the form.
					$finalElements[] = array($element, null);
				}
			}
		}
		
		// Add elements related to class properties to the form.
		foreach ($finalElements as $element){
			$this->form->addElement($element[0]);
		}
		
		//add an hidden elt for the class uri
		$classUriElt = tao_helpers_form_FormFactory::getElement('classUri', 'Hidden');
		$classUriElt->setValue(tao_helpers_Uri::encode($clazz->getUri()));
		$this->form->addElement($classUriElt);
			
		if(!is_null($instance)){
			//add an hidden elt for the instance Uri
			$instanceUriElt = tao_helpers_form_FormFactory::getElement('uri', 'Hidden');
			$instanceUriElt->setValue(tao_helpers_Uri::encode($instance->getUri()));
			$this->form->addElement($instanceUriElt);
			
			$hiddenId = tao_helpers_form_FormFactory::getElement('id', 'Hidden');
			$hiddenId->setValue($instance->getUri());
			$this->form->addElement($hiddenId);
		}
        
        
    }
</pre>
                    </div>
                </li>

                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1daeec8" aria-expanded="false" aria-controls="trace-id-548f1e1daeec8">
                        initElements [/var/www/tao/actions/form/class.Users.php (160)]
                    </a>
                                        <div id="trace-id-548f1e1daeec8" class="collapse">
                        <style>
                            .classtrace-id-548f1e1daeec8 li:nth-child(9 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1daeec8 prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        <li>
        <span>Nbr call for this trace : 1</span>
        <ul>
                        <li>
                    <a data-toggle="collapse"  href="#trace-id-548f1e1daf92f" aria-expanded="false" aria-controls="trace-id-548f1e1daf92f">
                        getLabel [/var/www/tao/actions/form/class.Users.php (210)]
                    </a>
                                        <div id="trace-id-548f1e1daf92f" class="collapse">
                        <style>
                            .classtrace-id-548f1e1daf92f li:nth-child(59 ) { background: rgb(255,200,200) }
                        </style>
                        <pre class="classtrace-id-548f1e1daf92f prettyprint linenums:152 linenums">    protected function initElements()
    {
        
		
		if(!isset($this->options['mode'])){
			throw new Exception("Please set a mode into container options ");
		}
		
		parent::initElements();
		
		//login field
		$loginElement = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_LOGIN));
		$loginElement->setDescription($loginElement->getDescription() . ' *');
		if($this->options['mode'] == 'add'){
			$loginElement->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Callback', array(
					'object' => tao_models_classes_UserService::singleton(), 
					'method' => 'loginAvailable', 
					'message' => __('This Login is already in use') 
				))
			));
		}
		else{
			$loginElement->setAttributes(array('readonly' => 'readonly', 'disabled' => 'disabled'));
		}
		
		
		//set default lang to the languages fields
		$langService = tao_models_classes_LanguageService::singleton();
		
		$dataLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_DEFLG));
		$dataLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$dataLangElt->setDescription($dataLangElt->getDescription() . ' *');
    	$dataUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_DATA);
		$dataOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($dataUsage) as $lang){
			$dataOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$dataLangElt->setOptions($dataOptions);
		
		$uiLangElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_UILG));
        $uiLangElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
        $uiLangElt->setDescription($uiLangElt->getDescription() . ' *');
    	$guiUsage = new core_kernel_classes_Resource(INSTANCE_LANGUAGE_USAGE_GUI);
		$guiOptions = array();
        foreach($langService->getAvailableLanguagesByUsage($guiUsage) as $lang){
			$guiOptions[tao_helpers_Uri::encode($lang->getUri())] = $lang->getLabel();
		}
		$uiLangElt->setOptions($guiOptions);
		
		// roles field
		$restrictedRoles = array();
		$rolesClass = new core_kernel_classes_Class(CLASS_ROLE);
		$roles = $rolesClass->getInstances(true);
		$rolesOptions = array();
		foreach ($roles as $r){
			if (false === in_array($r->getUri(), $restrictedRoles)){
				$rolesOptions[tao_helpers_Uri::encode($r->getUri())] = $r->getLabel();
			}
		}
								 
		$rolesElt = $this->form->getElement(tao_helpers_Uri::encode(PROPERTY_USER_ROLES));
		$rolesElt->setDescription($rolesElt->getDescription() . ' *');
		$rolesElt->addValidator(tao_helpers_form_FormFactory::getValidator('NotEmpty'));
		$rolesElt->setOptions($rolesOptions);
		
		// password field
		$this->form->removeElement(tao_helpers_Uri::encode(PROPERTY_USER_PASSWORD));
		
		if($this->options['mode'] == 'add'){
			$pass1Element = tao_helpers_form_FormFactory::getElement('password1', 'Hiddenbox');
			$pass1Element->setDescription(__('Password *'));
			$pass1Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
			));
			$this->form->addElement($pass1Element);
			
			$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
			$pass2Element->setDescription(__('Repeat password *'));
			$pass2Element->addValidators(array(
				tao_helpers_form_FormFactory::getValidator('NotEmpty'),
				tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass1Element)),
			));
			$this->form->addElement($pass2Element);
		}
		else {
			if (helpers_PlatformInstance::isDemo()) {
				$warning  = tao_helpers_form_FormFactory::getElement('warningpass', 'Label');
				$warning->setValue(__('Unable to change passwords in demo mode'));
				$this->form->addElement($warning);
				$this->form->createGroup("pass_group", __("Change the password"), array('warningpass'));
			} else {
			
				$pass2Element = tao_helpers_form_FormFactory::getElement('password2', 'Hiddenbox');
				$pass2Element->setDescription(__('New password'));
				$pass2Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Length', array('min' => 3))
				));
				$this->form->addElement($pass2Element);
				
				$pass3Element = tao_helpers_form_FormFactory::getElement('password3', 'Hiddenbox');
				$pass3Element->setDescription(__('Repeat new password'));
				$pass3Element->addValidators(array(
					tao_helpers_form_FormFactory::getValidator('Password', array('password2_ref' => $pass2Element)),
				));
				$this->form->addElement($pass3Element);
				
				$this->form->createGroup("pass_group", __("Change the password"), array('password1', 'password2', 'password3'));
				if (empty($_POST[$pass2Element->getName()]) && empty($_POST[$pass3Element->getName()])) {

					$pass2Element->setForcedValid();
					$pass3Element->setForcedValid();
				}
			}
		}
		/**/
		
		
        
    }
</pre>
                    </div>
                </li>

                </ul>
        </li>
    <li>

        <span>Common ending trace :</span>
        <ul>
                <li>&nbsp; => initElements [/var/www/taoTestTaker/actions/form/TestTaker.php (45)]</li>
                <li>&nbsp;&nbsp; => initElements [/var/www/tao/helpers/form/class.FormContainer.php (100)]</li>
                <li>&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Generis.php (95)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/tao/actions/form/class.Users.php (98)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => __construct [/var/www/taoTestTaker/actions/TestTaker.php (132)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => editSubject [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => call_user_func_array:{/var/www/tao/models/classes/routing/ActionEnforcer.php:137} [/var/www/tao/models/classes/routing/ActionEnforcer.php (137)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => execute [/var/www/tao/models/classes/routing/TaoFrontController.php (73)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => loadModule [/var/www/tao/includes/class.Bootstrap.php (378)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => mvc [/var/www/tao/includes/class.Bootstrap.php (163)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => dispatch [/var/www/taoTestTaker/index.php (38)]</li>
                <li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; => {main} [/var/www/taoTestTaker/index.php (0)]</li>
            </ul>
    </li>
</ul>                            </div>
                        </div>
                    </div>
                                    </div>
                            </div>
        </div>
                                </div>
                        </div>
                                    </div>
            </div>
        </div>
    </div>
    </body>
</html>
